{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{416:function(s,t,a){\"use strict\";a.r(t);var n=a(4),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":s.$parent.slotKey}},[t(\"h2\",{attrs:{id:\"_1-nacos-配置管理\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-nacos-配置管理\"}},[s._v(\"#\")]),s._v(\" 1. Nacos 配置管理\")]),s._v(\" \"),t(\"p\",[s._v(\"Nacos 除了可以做注册中心，同样可以做配置管理来使用。\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_1-1-统一配置管理\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-1-统一配置管理\"}},[s._v(\"#\")]),s._v(\" 1.1 统一配置管理\")]),s._v(\" \"),t(\"p\",[s._v(\"当微服务部署的实例越来越多，达到数十、数百时，逐个修改微服务配置就会让人抓狂，而且很容易出错。我们需要一种统一配置管理方案，可以\"),t(\"strong\",[s._v(\"集中管理所有实例的配置\")]),s._v(\"。\")]),s._v(\" \"),t(\"img\",{staticStyle:{zoom:\"50%\"},attrs:{src:\"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210714164426792.png\",alt:\"image-20210714164426792\"}}),s._v(\" \"),t(\"p\",[s._v(\"Nacos 一方面可以将配置集中管理，另一方可以在配置变更时，及时通知微服务，实现\"),t(\"strong\",[s._v(\"配置的热更新\")]),s._v(\"。\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"_1-1-在-nacos-中添加配置文件\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-1-在-nacos-中添加配置文件\"}},[s._v(\"#\")]),s._v(\" 1.1 在 nacos 中添加配置文件\")]),s._v(\" \"),t(\"p\",[s._v(\"在 nacos 控制台的\"),t(\"code\",[s._v(\"配置列表\")]),s._v(\"一栏中，可以添加配置文件，填写如下配置信息：\")]),s._v(\" \"),t(\"img\",{staticStyle:{zoom:\"50%\"},attrs:{src:\"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210714164856664.png\",alt:\"image-20210714164856664\"}}),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"注意：项目的核心配置，\"),t(\"strong\",[s._v(\"需要热更新的配置才有放到 nacos 管理的必要\")]),s._v(\"。基本不会变更的一些配置还是保存在微服务本地比较好。\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"_1-1-2-从微服务拉取配置\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-1-2-从微服务拉取配置\"}},[s._v(\"#\")]),s._v(\" 1.1.2 从微服务拉取配置\")]),s._v(\" \"),t(\"p\",[s._v(\"微服务要拉取 nacos 中管理的配置，并且与本地的 application.yml \"),t(\"strong\",[s._v(\"配置合并\")]),s._v(\"，才能完成项目启动。\")]),s._v(\" \"),t(\"p\",[s._v(\"但如果尚未读取 application.yml，又如何得知 nacos 地址呢？因此 Spring 引入了一种新的配置文件：\"),t(\"strong\",[s._v(\"bootstrap.yaml 文件\")]),s._v(\"，会在 application.yml 之前被读取，流程如下：\")]),s._v(\" \"),t(\"img\",{staticStyle:{zoom:\"67%\"},attrs:{src:\"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/L0iFYNF.png\",alt:\"img\"}}),s._v(\" \"),t(\"h5\",{attrs:{id:\"_1-引入-nacos-config-依赖\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-引入-nacos-config-依赖\"}},[s._v(\"#\")]),s._v(\" 1）引入 nacos-config 依赖\")]),s._v(\" \"),t(\"p\",[s._v(\"首先，在 user-service 服务中，引入 nacos-config 的客户端依赖：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-xml line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-xml\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"\\x3c!--nacos配置管理依赖--\\x3e\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),s._v(\"dependency\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),s._v(\"groupId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"com.alibaba.cloud\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"</\")]),s._v(\"groupId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),s._v(\"artifactId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"spring-cloud-starter-alibaba-nacos-config\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"</\")]),s._v(\"artifactId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"</\")]),s._v(\"dependency\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\")])]),t(\"h5\",{attrs:{id:\"_2-添加-bootstrap-yaml\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-添加-bootstrap-yaml\"}},[s._v(\"#\")]),s._v(\" 2）添加 bootstrap.yaml\")]),s._v(\" \"),t(\"p\",[s._v(\"然后，在 user-service 中添加一个 bootstrap.yaml 文件：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-yaml line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"spring\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"application\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"name\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" userservice \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 服务名称\")]),s._v(\"\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"profiles\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"active\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" dev \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#开发环境，这里是dev \")]),s._v(\"\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"cloud\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"nacos\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"server-addr\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" localhost\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"8848\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# Nacos地址\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"config\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"file-extension\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" yaml \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 文件后缀名\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\")])]),t(\"p\",[s._v(\"这里会根据 \"),t(\"code\",[s._v(\"spring.cloud.nacos.server-addr\")]),s._v(\" 获取 nacos 地址，再根据\")]),s._v(\" \"),t(\"p\",[t(\"code\",[s._v(\"${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension}\")]),s._v(\" 作为文件id，来读取配置。\")]),s._v(\" \"),t(\"p\",[s._v(\"比如本例中，就是去读取 \"),t(\"code\",[s._v(\"userservice-dev.yaml\")]),s._v(\"：\")]),s._v(\" \"),t(\"img\",{staticStyle:{zoom:\"67%\"},attrs:{src:\"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210714170845901.png\",alt:\"image-20210714170845901\"}}),s._v(\" \"),t(\"h5\",{attrs:{id:\"_3-读取-nacos-配置\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-读取-nacos-配置\"}},[s._v(\"#\")]),s._v(\" 3）读取 nacos 配置\")]),s._v(\" \"),t(\"p\",[s._v(\"在 user-service 中的 UserController 中添加业务逻辑，读取 pattern.dateformat 配置（这个配置字段是写在 nacos 中的）：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-java line-numbers-mode\"},[t(\"div\",{staticClass:\"highlight-lines\"},[t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"div\",{staticClass:\"highlighted\"},[s._v(\" \")]),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\")]),t(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"import\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token import\"}},[t(\"span\",{pre:!0,attrs:{class:\"token namespace\"}},[s._v(\"org\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"springframework\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"beans\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"factory\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"annotation\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")])]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Value\")])]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@Slf4j\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@RestController\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@RequestMapping\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/user\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"public\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"class\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"UserController\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@Autowired\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"private\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"UserService\")]),s._v(\" userService\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@Value\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"${pattern.dateformat}\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"private\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"String\")]),s._v(\" dateformat\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n    \\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@GetMapping\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"now\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"public\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"String\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"now\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"return\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"LocalDateTime\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"now\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"format\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"DateTimeFormatter\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"ofPattern\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"dateformat\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// ...\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])]),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"第 12 行实际读取的是配置在 nacos 中的数据。\")])]),s._v(\" \"),t(\"p\",[s._v(\"启动后，在页面访问就可以看到效果。\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_1-2-配置热更新\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-2-配置热更新\"}},[s._v(\"#\")]),s._v(\" 1.2 配置热更新\")]),s._v(\" \"),t(\"p\",[s._v(\"刚刚的配置方式不能配置热更新，我们最终的目的，是修改 nacos 中的配置后，微服务中无需重启即可让配置生效，也就是\"),t(\"strong\",[s._v(\"配置热更新\")]),s._v(\"。\")]),s._v(\" \"),t(\"p\",[s._v(\"实现方式有两种：\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"方式一-用注解-refreshscope\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#方式一-用注解-refreshscope\"}},[s._v(\"#\")]),s._v(\" 🖊 方式一：用注解 \"),t(\"code\",[s._v(\"@RefreshScope\")])]),s._v(\" \"),t(\"p\",[s._v(\"在 @Value 注入的变量所在类上添加注解 \"),t(\"strong\",[s._v(\"@RefreshScope\")]),s._v(\"：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-java line-numbers-mode\"},[t(\"div\",{staticClass:\"highlight-lines\"},[t(\"br\"),t(\"br\"),t(\"br\"),t(\"div\",{staticClass:\"highlighted\"},[s._v(\" \")]),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\")]),t(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@Slf4j\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@RestController\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@RequestMapping\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/user\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@RefreshScope\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"public\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"class\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"UserController\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n    \\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@Value\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"${pattern.dateformat}\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"private\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"String\")]),s._v(\" dateformat\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\")])]),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"方式二-用注解-configurationproperties\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#方式二-用注解-configurationproperties\"}},[s._v(\"#\")]),s._v(\" 🖊 方式二：用注解 \"),t(\"code\",[s._v(\"@ConfigurationProperties\")])]),s._v(\" \"),t(\"p\",[s._v(\"使用 \"),t(\"strong\",[s._v(\"@ConfigurationProperties\")]),s._v(\" 注解代替 @Value 注解。\")]),s._v(\" \"),t(\"p\",[s._v(\"在 user-service 服务中，添加一个类，读取 nacos 中的 patterrn.dateformat 字段：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-java line-numbers-mode\"},[t(\"div\",{staticClass:\"highlight-lines\"},[t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"div\",{staticClass:\"highlighted\"},[s._v(\" \")]),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\")]),t(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"import\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token import\"}},[t(\"span\",{pre:!0,attrs:{class:\"token namespace\"}},[s._v(\"lombok\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")])]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Data\")])]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@Component\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@Data\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@ConfigurationProperties\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"prefix \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"pattern\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"public\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"class\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"PatternProperties\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"private\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"String\")]),s._v(\" dateformat\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])]),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\")])]),t(\"p\",[s._v(\"在 UserController 中使用这个类代替 @Value：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-java line-numbers-mode\"},[t(\"div\",{staticClass:\"highlight-lines\"},[t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"div\",{staticClass:\"highlighted\"},[s._v(\" \")]),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\")]),t(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@Slf4j\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@RestController\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@RequestMapping\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/user\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"public\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"class\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"UserController\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n    \\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@Autowired\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"private\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"PatternProperties\")]),s._v(\" patternProperties\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n    \\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@GetMapping\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"now\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"public\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"String\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"now\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"return\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"LocalDateTime\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"now\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"format\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"DateTimeFormatter\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"ofPattern\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"patternProperties\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"getDateformat\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"   \\n\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])]),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),t(\"br\")])]),t(\"h3\",{attrs:{id:\"_1-3-配置共享\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-3-配置共享\"}},[s._v(\"#\")]),s._v(\" 1.3 配置共享\")]),s._v(\" \"),t(\"blockquote\",[t(\"p\",[s._v(\"问题引入：我们可能在 dev 或 prod 等多个环境中，对同一个配置字段采用相同的值，那我们如果把在不同环境的配置文件中写相同的配置字段值，会产生冗余。那我们可不可以多个 profile 共享某一部分的配置数据呢？\")])]),s._v(\" \"),t(\"p\",[s._v(\"其实微服务启动时，会去 nacos \"),t(\"strong\",[s._v(\"读取多个配置文件\")]),s._v(\"，例如：\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[t(\"p\",[t(\"code\",[s._v(\"[spring.application.name]-[spring.profiles.active].yaml\")]),s._v(\"，例如：userservice-dev.yaml\")])]),s._v(\" \"),t(\"li\",[t(\"p\",[t(\"code\",[s._v(\"[spring.application.name].yaml\")]),s._v(\"，例如：userservice.yaml\")])])]),s._v(\" \"),t(\"p\",[s._v(\"无论 profile 如何变化，\"),t(\"code\",[s._v(\"[spring.application.name].yaml\")]),s._v(\" 这个文件一定会加载，因此\"),t(\"strong\",[s._v(\"多环境共享配置可以写入这个文件\")]),s._v(\"。\")]),s._v(\" \"),t(\"p\",[s._v(\"在 Nacos 中添加该配置文件后，按照之前的使用方式即可。可以看出来，不管是dev，还是test环境，都读取到了在这个配置中的属性值。\")]),s._v(\" \"),t(\"img\",{staticStyle:{zoom:\"45%\"},attrs:{src:\"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210714173519963.png\",alt:\"image-20210714173519963\"}}),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"在 \"),t(\"code\",[s._v(\"Active profiles\")]),s._v(\" 中可以修改所处的 profile 环境。\")])]),s._v(\" \"),t(\"h5\",{attrs:{id:\"配置文件的优先级\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#配置文件的优先级\"}},[s._v(\"#\")]),s._v(\" 配置文件的优先级\")]),s._v(\" \"),t(\"p\",[s._v(\"当 nacos、服务本地同时出现相同属性时，优先级有高低之分：\")]),s._v(\" \"),t(\"img\",{staticStyle:{zoom:\"50%\"},attrs:{src:\"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210714174623557.png\",alt:\"image-20210714174623557\"}}),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"线上（nacos）中的配置优先于本地配置；\")]),s._v(\" \"),t(\"li\",[s._v(\"当前环境的配置优先于共享环境的配置。\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_1-4-搭建-nacos-集群\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-4-搭建-nacos-集群\"}},[s._v(\"#\")]),s._v(\" 1.4 搭建 Nacos 集群\")]),s._v(\" \"),t(\"p\",[s._v(\"Nacos \"),t(\"strong\",[s._v(\"生产环境下一定要部署为集群状态\")]),s._v(\"。\")]),s._v(\" \"),t(\"p\",[s._v(\"大致步骤：\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"搭建 MySQL 集群并初始化数据库表\")]),s._v(\" \"),t(\"li\",[s._v(\"下载解压 nacos\")]),s._v(\" \"),t(\"li\",[s._v(\"修改集群配置（节点信息）、数据库配置\")]),s._v(\" \"),t(\"li\",[s._v(\"分别启动多个 nacos 节点\")]),s._v(\" \"),t(\"li\",[s._v(\"Nginx 反向代理\")])]),s._v(\" \"),t(\"h2\",{attrs:{id:\"_2-feign-远程调用\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-feign-远程调用\"}},[s._v(\"#\")]),s._v(\" 2. Feign 远程调用\")]),s._v(\" \"),t(\"p\",[s._v(\"先来看之前用 RestTemplate 发起远程调用的代码存在的问题：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-java line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"String\")]),s._v(\" url \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"http://userservice/user/\"')]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"+\")]),s._v(\" order\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"getUserId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"User\")]),s._v(\" user \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" restTemplate\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"getForObject\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"url\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"User\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"class\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"代码可读性差，编程体验不统一\")]),s._v(\" \"),t(\"li\",[s._v(\"参数复杂 URL 难以维护\")])]),s._v(\" \"),t(\"p\",[s._v(\"Feign 是一个声明式的 http 客户端，\"),t(\"a\",{attrs:{href:\"https://github.com/OpenFeign/feign\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s._v(\"官方地址\"),t(\"OutboundLink\")],1),s._v(\"，其作用就是帮助我们优雅的实现 http 请求的发送，解决上面提到的问题。\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_2-1-feign-替代-resttemplate\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-1-feign-替代-resttemplate\"}},[s._v(\"#\")]),s._v(\" 2.1 Feign 替代 RestTemplate\")]),s._v(\" \"),t(\"p\",[s._v(\"Feign 使用步骤如下：\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"_1-引入依赖\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-引入依赖\"}},[s._v(\"#\")]),s._v(\" 1）引入依赖\")]),s._v(\" \"),t(\"p\",[s._v(\"我们在 order-service 服务的 pom 文件中引入 feign 的依赖：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-xml line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-xml\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),s._v(\"dependency\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),s._v(\"groupId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"org.springframework.cloud\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"</\")]),s._v(\"groupId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),s._v(\"artifactId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"spring-cloud-starter-openfeign\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"</\")]),s._v(\"artifactId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"</\")]),s._v(\"dependency\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"_2-添加注解\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-添加注解\"}},[s._v(\"#\")]),s._v(\" 2）添加注解\")]),s._v(\" \"),t(\"p\",[s._v(\"在 order-service 的启动类添加注解开启 Feign 的功能：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-java line-numbers-mode\"},[t(\"div\",{staticClass:\"highlight-lines\"},[t(\"div\",{staticClass:\"highlighted\"},[s._v(\" \")]),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\")]),t(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@EnableFeignClients\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@MapperScan\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"cn.itcast.order.mapper\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@SpringBootApplication\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"public\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"class\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"OrderApplication\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"public\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"static\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"void\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"main\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"String\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\" args\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"SpringApplication\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"run\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"OrderApplication\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"class\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" args\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])]),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"_3-编写-feign-的客户端\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-编写-feign-的客户端\"}},[s._v(\"#\")]),s._v(\" 3）编写 Feign 的客户端\")]),s._v(\" \"),t(\"p\",[s._v(\"在 order-service 中新建一个接口，内容如下：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-java line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"package\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token namespace\"}},[s._v(\"cn\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"itcast\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"order\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"client\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"import\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token import\"}},[t(\"span\",{pre:!0,attrs:{class:\"token namespace\"}},[s._v(\"org\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"springframework\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"cloud\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"openfeign\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")])]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"FeignClient\")])]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"\\n    \\n\"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@FeignClient\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"userservice\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"public\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"interface\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"UserClient\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@GetMapping\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/user/{id}\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"User\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"findById\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@PathVariable\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"id\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Long\")]),s._v(\" id\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\")])]),t(\"p\",[s._v(\"这个客户端主要是基于 Spring MVC 的注解来声明远程调用的信息，比如：\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"服务名称：userservice\")]),s._v(\" \"),t(\"li\",[s._v(\"请求方式：GET\")]),s._v(\" \"),t(\"li\",[s._v(\"请求路径：/user/{id}\")]),s._v(\" \"),t(\"li\",[s._v(\"请求参数：Long id\")]),s._v(\" \"),t(\"li\",[s._v(\"返回值类型：User\")])]),s._v(\" \"),t(\"blockquote\",[t(\"p\",[s._v(\"这很像 controller，这正是 Feign 为了方便我们的学习所做的。\")])]),s._v(\" \"),t(\"p\",[s._v(\"这样，Feign 就可以帮助我们发送 http 请求，无需自己使用 RestTemplate 来发送了。\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"_4-测试\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_4-测试\"}},[s._v(\"#\")]),s._v(\" 4）测试\")]),s._v(\" \"),t(\"p\",[s._v(\"修改 order-service 中的 OrderService 类中的 queryOrderById 方法，使用 Feign 客户端代替 RestTemplate：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-java line-numbers-mode\"},[t(\"div\",{staticClass:\"highlight-lines\"},[t(\"br\"),t(\"div\",{staticClass:\"highlighted\"},[s._v(\" \")]),t(\"br\"),t(\"br\"),t(\"br\"),t(\"div\",{staticClass:\"highlighted\"},[s._v(\" \")]),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\")]),t(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@Autowired\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"private\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"UserClient\")]),s._v(\" userClient\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"public\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Order\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"queryOrderById\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Long\")]),s._v(\" orderId\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Order\")]),s._v(\" order \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" orderMapper\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"findById\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"orderId\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"User\")]),s._v(\" user \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" userClient\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"findById\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"order\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"getUserId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n    order\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"setUser\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"user\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"return\")]),s._v(\" order\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])]),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\")])]),t(\"h3\",{attrs:{id:\"_2-2-自定义配置\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-2-自定义配置\"}},[s._v(\"#\")]),s._v(\" 2.2 自定义配置\")]),s._v(\" \"),t(\"p\",[s._v(\"Feign 可以支持很多的自定义配置，如下表所示：\")]),s._v(\" \"),t(\"table\",[t(\"thead\",[t(\"tr\",[t(\"th\",[s._v(\"类型\")]),s._v(\" \"),t(\"th\",[s._v(\"作用\")]),s._v(\" \"),t(\"th\",[s._v(\"说明\")])])]),s._v(\" \"),t(\"tbody\",[t(\"tr\",[t(\"td\",[t(\"strong\",[s._v(\"feign.Logger.Level\")])]),s._v(\" \"),t(\"td\",[s._v(\"修改日志级别\")]),s._v(\" \"),t(\"td\",[s._v(\"包含四种不同的级别：NONE、BASIC、HEADERS、FULL。默认是 NONE。\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",[s._v(\"feign.codec.Decoder\")]),s._v(\" \"),t(\"td\",[s._v(\"响应结果的解析器\")]),s._v(\" \"),t(\"td\",[s._v(\"http 远程调用的结果做解析，例如解析 json 字符串为 java 对象\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",[s._v(\"feign.codec.Encoder\")]),s._v(\" \"),t(\"td\",[s._v(\"请求参数编码\")]),s._v(\" \"),t(\"td\",[s._v(\"将请求参数编码，便于通过 http 请求发送\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",[s._v(\"feign. Contract\")]),s._v(\" \"),t(\"td\",[s._v(\"支持的注解格式\")]),s._v(\" \"),t(\"td\",[s._v(\"默认是 Spring MVC 的注解\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",[s._v(\"feign. Retryer\")]),s._v(\" \"),t(\"td\",[s._v(\"失败重试机制\")]),s._v(\" \"),t(\"td\",[s._v(\"请求失败的重试机制，默认是没有，不过会使用 Ribbon 的重试\")])])])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"一般情况下，默认值就能满足我们使用，如果要自定义时，只需要创建自定义的 @Bean 覆盖默认 Bean 即可。通常我们需要配置的就是日志级别。\")])]),s._v(\" \"),t(\"p\",[s._v(\"下面以配置日志格式为例来演示如何自定义配置。\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"方式一-配置文件方式\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#方式一-配置文件方式\"}},[s._v(\"#\")]),s._v(\" 🖊 方式一：配置文件方式\")]),s._v(\" \"),t(\"p\",[s._v(\"基于配置文件修改 feign 的日志级别可以针对单个服务：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-yaml line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"feign\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"  \\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"client\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"config\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"userservice\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 针对某个微服务的配置\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"loggerLevel\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" FULL \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#  日志级别 \")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\")])]),t(\"p\",[s._v(\"也可以针对所有服务：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-yaml line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"feign\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"  \\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"client\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"config\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"default\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 这里用default就是全局配置，如果是写服务名称，则是针对某个微服务的配置\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"loggerLevel\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" FULL \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#  日志级别 \")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\")])]),t(\"p\",[s._v(\"日志的级别分为四种：\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"NONE：不记录任何日志信息，这是默认值。\")]),s._v(\" \"),t(\"li\",[s._v(\"BASIC：仅记录请求的方法，URL 以及响应状态码和执行时间\")]),s._v(\" \"),t(\"li\",[s._v(\"HEADERS：在 BASIC 的基础上，额外记录了请求和响应的头信息\")]),s._v(\" \"),t(\"li\",[s._v(\"FULL：记录所有请求和响应的明细，包括头信息、请求体、元数据。\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"方式二-java-代码方式\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#方式二-java-代码方式\"}},[s._v(\"#\")]),s._v(\" 🖊 方式二：Java 代码方式\")]),s._v(\" \"),t(\"p\",[s._v(\"也可以基于Java代码来修改日志级别，先声明一个类，然后声明一个 \"),t(\"code\",[s._v(\"Logger.Level\")]),s._v(\" 的对象：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-java line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"public\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"class\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"DefaultFeignConfiguration\")]),s._v(\"  \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@Bean\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"public\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Logger\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"Level\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"feignLogLevel\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"return\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Logger\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"Level\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token constant\"}},[s._v(\"BASIC\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// 日志级别为BASIC\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\")])]),t(\"p\",[s._v(\"而后，如果要\"),t(\"strong\",[s._v(\"全局生效\")]),s._v(\"，将其放到启动类的 @EnableFeignClients 这个注解中：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-java line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@EnableFeignClients\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"defaultConfiguration \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"DefaultFeignConfiguration\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"class\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"p\",[s._v(\"如果是\"),t(\"strong\",[s._v(\"局部生效\")]),s._v(\"，则把它放到对应的 @FeignClient 这个注解中：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-java line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@FeignClient\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"value \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"userservice\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" configuration \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"DefaultFeignConfiguration\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"class\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"h3\",{attrs:{id:\"_2-3-feign-性能优化\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-3-feign-性能优化\"}},[s._v(\"#\")]),s._v(\" 2.3 Feign 性能优化\")]),s._v(\" \"),t(\"p\",[s._v(\"Feign 底层发起 http 请求，依赖于其它的框架。其底层客户端实现包括：\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"URLConnection：JDK 自带，默认实现，\"),t(\"strong\",[s._v(\"不支持连接池\")])]),s._v(\" \"),t(\"li\",[s._v(\"Apache HttpClient ：支持连接池\")]),s._v(\" \"),t(\"li\",[s._v(\"OKHttp：支持连接池\")])]),s._v(\" \"),t(\"p\",[s._v(\"因此提高 Feign 的性能主要手段就是\"),t(\"strong\",[s._v(\"使用连接池\")]),s._v(\"代替默认的 URLConnection。\")]),s._v(\" \"),t(\"p\",[s._v(\"这里我们用 Apache 的 HttpClient 来演示。\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"_1-引入依赖-2\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-引入依赖-2\"}},[s._v(\"#\")]),s._v(\" 1）引入依赖\")]),s._v(\" \"),t(\"p\",[s._v(\"在 order-service 的 pom 文件中引入 Apache 的 HttpClient 依赖：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-xml line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-xml\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"\\x3c!--httpClient的依赖 --\\x3e\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),s._v(\"dependency\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),s._v(\"groupId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"io.github.openfeign\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"</\")]),s._v(\"groupId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),s._v(\"artifactId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"feign-httpclient\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"</\")]),s._v(\"artifactId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"</\")]),s._v(\"dependency\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"_2-配置连接池\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-配置连接池\"}},[s._v(\"#\")]),s._v(\" 2）配置连接池\")]),s._v(\" \"),t(\"p\",[s._v(\"在 order-service 的 application.yml 中添加配置：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-yaml line-numbers-mode\"},[t(\"div\",{staticClass:\"highlight-lines\"},[t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"div\",{staticClass:\"highlighted\"},[s._v(\" \")]),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\")]),t(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"feign\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"client\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"config\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"default\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# default全局的配置\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"loggerLevel\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" BASIC \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 日志级别，BASIC就是基本的请求和响应信息\")]),s._v(\"\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"httpclient\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"enabled\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token boolean important\"}},[s._v(\"true\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 开启feign对HttpClient的支持\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"max-connections\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"200\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 最大的连接数\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"max-connections-per-route\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"50\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 每个路径的最大连接数\")]),s._v(\"\\n\")])]),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\")])]),t(\"div\",{staticClass:\"custom-block tip\"},[t(\"p\",{staticClass:\"custom-block-title\"},[s._v(\"总结：Feign 的优化\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"日志级别尽量用 basic\")]),s._v(\" \"),t(\"li\",[s._v(\"使用 HttpClient 或 OKHttp 代替 URLConnection\\n\"),t(\"ul\",[t(\"li\",[s._v(\"引入 feign-httpClient 依赖\")]),s._v(\" \"),t(\"li\",[s._v(\"配置文件开启 httpClient 功能，设置连接池参数\")])])])])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_2-4-feign-最佳实践\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-4-feign-最佳实践\"}},[s._v(\"#\")]),s._v(\" 2.4 Feign 最佳实践\")]),s._v(\" \"),t(\"p\",[s._v(\"对比 Feign Client 和所调用的 Controller，可以发现两者代码存在冗余，有没有什么办法能够简化这种重复代码的编写呢？\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"_2-4-1-继承方式\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-4-1-继承方式\"}},[s._v(\"#\")]),s._v(\" 2.4.1 继承方式\")]),s._v(\" \"),t(\"p\",[s._v(\"一样的代码可以通过继承来共享：\")]),s._v(\" \"),t(\"p\",[s._v(\"1）定义一个 API 接口，利用定义方法，并基于 Spring MVC 注解做声明。\")]),s._v(\" \"),t(\"p\",[s._v(\"2）Feign 客户端和 Controller 都集成该接口\")]),s._v(\" \"),t(\"img\",{staticStyle:{zoom:\"80%\"},attrs:{src:\"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210714190640857.png\",alt:\"image-20210714190640857\"}}),s._v(\" \"),t(\"p\",[s._v(\"优点：简单，实现了代码共享\")]),s._v(\" \"),t(\"p\",[s._v(\"缺点：\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"服务的提供方、消费方紧耦合\")]),s._v(\" \"),t(\"li\",[s._v(\"参数列表中的注解映射并不会继承，因此 Controller 中必须再次声明方法、参数列表、注解\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"_2-4-2-抽取方式\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-4-2-抽取方式\"}},[s._v(\"#\")]),s._v(\" 2.4.2 抽取方式\")]),s._v(\" \"),t(\"p\",[s._v(\"将 Feign 的 Client \"),t(\"strong\",[s._v(\"抽取为独立模块\")]),s._v(\"，并且把接口有关的 POJO、默认的 Feign 配置都放到这个模块中，提供给所有消费者使用。\")]),s._v(\" \"),t(\"p\",[s._v(\"例如，将 UserClient、User、Feign 的默认配置都抽取到一个 feign-api 包中，所有微服务引用该依赖包，即可直接使用。\")]),s._v(\" \"),t(\"img\",{staticStyle:{zoom:\"67%\"},attrs:{src:\"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210714214041796.png\",alt:\"image-20210714214041796\"}}),s._v(\" \"),t(\"h4\",{attrs:{id:\"_2-4-3-实现基于抽取的最佳实践\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-4-3-实现基于抽取的最佳实践\"}},[s._v(\"#\")]),s._v(\" 2.4.3 实现基于抽取的最佳实践\")]),s._v(\" \"),t(\"h5\",{attrs:{id:\"_1-抽取\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-抽取\"}},[s._v(\"#\")]),s._v(\" 1）抽取\")]),s._v(\" \"),t(\"p\",[s._v(\"首先创建一个 module，命名为 feign-api：\")]),s._v(\" \"),t(\"img\",{staticStyle:{zoom:\"67%\"},attrs:{src:\"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210714204656214.png\",alt:\"image-20210714204656214\"}}),s._v(\" \"),t(\"p\",[s._v(\"在 feign-api 中然后引入 feign 的 starter 依赖：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-xml line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-xml\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),s._v(\"dependency\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),s._v(\"groupId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"org.springframework.cloud\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"</\")]),s._v(\"groupId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),s._v(\"artifactId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"spring-cloud-starter-openfeign\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"</\")]),s._v(\"artifactId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"</\")]),s._v(\"dependency\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\")])]),t(\"p\",[s._v(\"然后将原来 order-service 中编写的 UserClient、User、DefaultFeignConfiguration 都抽取到 feign-api 项目中\")]),s._v(\" \"),t(\"img\",{staticStyle:{zoom:\"50%\"},attrs:{src:\"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210714205221970.png\",alt:\"image-20210714205221970\"}}),s._v(\" \"),t(\"h5\",{attrs:{id:\"_2-在-order-service-中使用-feign-api\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-在-order-service-中使用-feign-api\"}},[s._v(\"#\")]),s._v(\" 2）在 order-service 中使用 feign-api\")]),s._v(\" \"),t(\"p\",[s._v(\"在 order-service 的 pom 文件中中引入 feign-api 的依赖：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-xml line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-xml\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),s._v(\"dependency\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),s._v(\"groupId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"cn.itcast.demo\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"</\")]),s._v(\"groupId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),s._v(\"artifactId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"feign-api\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"</\")]),s._v(\"artifactId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),s._v(\"version\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"1.0\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"</\")]),s._v(\"version\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"</\")]),s._v(\"dependency\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\")])]),t(\"p\",[s._v(\"修改 order-service 中的所有与上述三个组件有关的导包部分，改成导入 feign-api 中的包。\")]),s._v(\" \"),t(\"h5\",{attrs:{id:\"_3-重启测试\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-重启测试\"}},[s._v(\"#\")]),s._v(\" 3）重启测试\")]),s._v(\" \"),t(\"p\",[s._v(\"重启后，发现服务报错了：\")]),s._v(\" \"),t(\"img\",{staticStyle:{zoom:\"80%\"},attrs:{src:\"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210714205623048.png\",alt:\"image-20210714205623048\"}}),s._v(\" \"),t(\"p\",[s._v(\"这是因为 UserClient 现在在cn.itcast.feign.clients包下，而 order-service 的 @EnableFeignClients 注解是在 cn.itcast.order 包下，不在同一个包，无法扫描到 UserClient。\")]),s._v(\" \"),t(\"h5\",{attrs:{id:\"_4-解决扫描包问题\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_4-解决扫描包问题\"}},[s._v(\"#\")]),s._v(\" 4）解决扫描包问题\")]),s._v(\" \"),t(\"p\",[s._v(\"🖊 方式1：指定Feign应该扫描的包\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-java line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@EnableFeignClients\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"basePackages \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"cn.itcast.feign.clients\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"p\",[s._v(\"🖊 方式2：指定需要加载的 Client 接口【推荐】\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-java line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@EnableFeignClients\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"clients \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"UserClient\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"class\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"h2\",{attrs:{id:\"_3-gateway-服务网关\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-gateway-服务网关\"}},[s._v(\"#\")]),s._v(\" 3. Gateway 服务网关\")]),s._v(\" \"),t(\"p\",[s._v(\"Spring Cloud Gateway 是 Spring Cloud 的一个全新项目，该项目是基于 Spring 5.0，Spring Boot 2.0 和 Project Reactor 等响应式编程和事件流技术开发的网关，它旨在为微服务架构提供一种简单有效的统一的 API 路由管理方式。\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_3-1-为什么需要网关\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-1-为什么需要网关\"}},[s._v(\"#\")]),s._v(\" 3.1 为什么需要网关\")]),s._v(\" \"),t(\"p\",[s._v(\"Gateway 网关是我们服务的守门神，所有微服务的统一入口。\")]),s._v(\" \"),t(\"img\",{staticStyle:{zoom:\"67%\"},attrs:{src:\"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210714210131152.png\",alt:\"image-20210714210131152\"}}),s._v(\" \"),t(\"p\",[s._v(\"网关的\"),t(\"strong\",[s._v(\"核心功能特性\")]),s._v(\"：请求路由，权限控制，限流。\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[t(\"strong\",[s._v(\"权限控制\")]),s._v(\"：网关作为微服务入口，需要校验用户是是否有请求资格，如果没有则进行拦截。\")]),s._v(\" \"),t(\"li\",[t(\"strong\",[s._v(\"路由和负载均衡\")]),s._v(\"：一切请求都必须先经过 Gateway，但网关不处理业务，而是根据某种规则，把请求转发到某个微服务，这个过程叫做路由。当然路由的目标服务有多个时，还需要做负载均衡。\")]),s._v(\" \"),t(\"li\",[t(\"strong\",[s._v(\"限流\")]),s._v(\"：当请求流量过高时，在网关中按照下流的微服务能够接受的速度来放行请求，避免服务压力过大。\")])]),s._v(\" \"),t(\"p\",[s._v(\"在 Spring Cloud 中网关的实现包括两种：\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"Zuul：基于Servlet的实现，属于阻塞式编程\")]),s._v(\" \"),t(\"li\",[s._v(\"Gateway：基于 Spring 5 中提供的 WebFlux，属于响应式编程的实现，具备更好的性能。现在往往使用 Spring Cloud Gateway。\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_3-2-gateway-快速入门\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-2-gateway-快速入门\"}},[s._v(\"#\")]),s._v(\" 3.2 Gateway 快速入门\")]),s._v(\" \"),t(\"p\",[s._v(\"网关是一个独立的服务。\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"_1-创建-gateway-服务-引入依赖\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-创建-gateway-服务-引入依赖\"}},[s._v(\"#\")]),s._v(\" 1）创建 Gateway 服务，引入依赖\")]),s._v(\" \"),t(\"p\",[s._v(\"创建一个单独的 module 来创建服务，并引入依赖：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-xml line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-xml\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"\\x3c!--网关--\\x3e\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),s._v(\"dependency\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),s._v(\"groupId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"org.springframework.cloud\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"</\")]),s._v(\"groupId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),s._v(\"artifactId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"spring-cloud-starter-gateway\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"</\")]),s._v(\"artifactId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"</\")]),s._v(\"dependency\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"\\x3c!--nacos服务发现依赖--\\x3e\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),s._v(\"dependency\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),s._v(\"groupId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"com.alibaba.cloud\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"</\")]),s._v(\"groupId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),s._v(\"artifactId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"spring-cloud-starter-alibaba-nacos-discovery\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"</\")]),s._v(\"artifactId\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"</\")]),s._v(\"dependency\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"_2-编写启动类\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-编写启动类\"}},[s._v(\"#\")]),s._v(\" 2）编写启动类\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-java line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@SpringBootApplication\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"public\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"class\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"GatewayApplication\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n\\n\\t\"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"public\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"static\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"void\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"main\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"String\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\" args\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n\\t\\t\"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"SpringApplication\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"run\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"GatewayApplication\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"class\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" args\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\\t\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"_3-编写基础配置和路由规则\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-编写基础配置和路由规则\"}},[s._v(\"#\")]),s._v(\" 3）编写基础配置和路由规则\")]),s._v(\" \"),t(\"p\",[s._v(\"创建 application.yml 文件，内容如下：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-yaml line-numbers-mode\"},[t(\"div\",{staticClass:\"highlight-lines\"},[t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"div\",{staticClass:\"highlighted\"},[s._v(\" \")]),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\")]),t(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"server\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"port\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10010\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 网关端口\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"spring\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"application\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"name\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" gateway \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 服务名称\")]),s._v(\"\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"cloud\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"nacos\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"server-addr\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" localhost\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"8848\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# nacos地址\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"gateway\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"routes\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 网关路由配置\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"id\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" user\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\"service \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 路由id，自定义，只要唯一即可\")]),s._v(\"\\n          \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# uri: http://127.0.0.1:8081 # 路由的目标地址 http就是固定地址\")]),s._v(\"\\n          \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"uri\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" lb\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"//userservice \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 路由的目标地址 lb就是负载均衡，后面跟服务名称\")]),s._v(\"\\n          \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"predicates\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 路由断言，也就是判断请求是否符合路由规则的条件\")]),s._v(\"\\n            \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" Path=/user/\"),t(\"span\",{pre:!0,attrs:{class:\"token important\"}},[s._v(\"**\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 这个是按照路径匹配，只要以/user/开头就符合要求\")]),s._v(\"\\n\")])]),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"这会将符合 \"),t(\"code\",[s._v(\"Path\")]),s._v(\" 规则的一切请求，都代理到 \"),t(\"code\",[s._v(\"uri\")]),s._v(\" 参数指定的地址。\")]),s._v(\" \"),t(\"li\",[s._v(\"本例中，我们将 \"),t(\"code\",[s._v(\"/user/**\")]),s._v(\" 开头的请求，代理到 \"),t(\"code\",[s._v(\"lb://userservice\")]),s._v(\"，lb 是负载均衡，根据服务名拉取服务列表，实现负载均衡。\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"_4-重启测试\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_4-重启测试\"}},[s._v(\"#\")]),s._v(\" 4）重启测试\")]),s._v(\" \"),t(\"p\",[s._v(\"重启网关，访问 \"),t(\"code\",[s._v(\"http://localhost:10010/user/1\")]),s._v(\" 时，符合 \"),t(\"code\",[s._v(\"/user/**\")]),s._v(\" 规则，请求转发到 URI：\"),t(\"code\",[s._v(\"http://userservice/user/1\")]),s._v(\"，从而得到了结果。\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"网关路由的流程图\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#网关路由的流程图\"}},[s._v(\"#\")]),s._v(\" 网关路由的流程图：\")]),s._v(\" \"),t(\"img\",{staticStyle:{zoom:\"80%\"},attrs:{src:\"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210714211742956.png\",alt:\"image-20210714211742956\"}}),s._v(\" \"),t(\"div\",{staticClass:\"custom-block tip\"},[t(\"p\",{staticClass:\"custom-block-title\"},[s._v(\"本节总结\")]),s._v(\" \"),t(\"p\",[s._v(\"网关搭建步骤：\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"创建项目，引入 nacos 服务发现和 gateway 依赖\")]),s._v(\" \"),t(\"li\",[s._v(\"配置 application.yml，包括服务基本信息、nacos 地址、路由\")])]),s._v(\" \"),t(\"p\",[s._v(\"路由配置包括：\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"路由 id：路由的唯一标示\")]),s._v(\" \"),t(\"li\",[s._v(\"路由目标（uri）：路由的目标地址，http 代表固定地址，lb 代表根据服务名负载均衡\")]),s._v(\" \"),t(\"li\",[s._v(\"路由断言（predicates）：判断路由的规则\")]),s._v(\" \"),t(\"li\",[s._v(\"路由过滤器（filters）：对请求或响应做处理\")])])]),s._v(\" \"),t(\"p\",[s._v(\"接下来，就重点来学习路由断言和路由过滤器的详细知识\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_3-3-断言工厂\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-3-断言工厂\"}},[s._v(\"#\")]),s._v(\" 3.3 断言工厂\")]),s._v(\" \"),t(\"p\",[s._v(\"我们在配置文件中写的断言规则只是字符串，这些字符串会被 \"),t(\"strong\",[s._v(\"Predicate Factory\")]),s._v(\" 读取并处理，转变为路由判断的条件。\")]),s._v(\" \"),t(\"p\",[s._v(\"例如 \"),t(\"code\",[s._v(\"Path=/user/**\")]),s._v(\" 是按照路径匹配，这个规则是由 \"),t(\"code\",[s._v(\"org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory\")]),s._v(\"  类来处理的，像这样的断言工厂在 Spring Cloud Gateway还有十几个：\")]),s._v(\" \"),t(\"table\",[t(\"thead\",[t(\"tr\",[t(\"th\",[t(\"strong\",[s._v(\"名称\")])]),s._v(\" \"),t(\"th\",[t(\"strong\",[s._v(\"说明\")])]),s._v(\" \"),t(\"th\",[t(\"strong\",[s._v(\"示例\")])])])]),s._v(\" \"),t(\"tbody\",[t(\"tr\",[t(\"td\",[s._v(\"After\")]),s._v(\" \"),t(\"td\",[s._v(\"是某个时间点后的请求\")]),s._v(\" \"),t(\"td\",[s._v(\"-  After=2037-01-20T17:42:47.789-07:00[America/Denver]\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",[s._v(\"Before\")]),s._v(\" \"),t(\"td\",[s._v(\"是某个时间点之前的请求\")]),s._v(\" \"),t(\"td\",[s._v(\"-  Before=2031-04-13T15:14:47.433+08:00[Asia/Shanghai]\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",[s._v(\"Between\")]),s._v(\" \"),t(\"td\",[s._v(\"是某两个时间点之前的请求\")]),s._v(\" \"),t(\"td\",[s._v(\"-  Between=2037-01-20T17:42:47.789-07:00[America/Denver],  2037-01-21T17:42:47.789-07:00[America/Denver]\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",[s._v(\"Cookie\")]),s._v(\" \"),t(\"td\",[s._v(\"请求必须包含某些cookie\")]),s._v(\" \"),t(\"td\",[s._v(\"- Cookie=chocolate, ch.p\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",[s._v(\"Header\")]),s._v(\" \"),t(\"td\",[s._v(\"请求必须包含某些header\")]),s._v(\" \"),t(\"td\",[s._v(\"- Header=X-Request-Id, \\\\d+\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",[s._v(\"Host\")]),s._v(\" \"),t(\"td\",[s._v(\"请求必须是访问某个host（域名）\")]),s._v(\" \"),t(\"td\",[s._v(\"-  Host=\"),t(\"strong\",[s._v(\".somehost.org,\")]),s._v(\".anotherhost.org\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",[s._v(\"Method\")]),s._v(\" \"),t(\"td\",[s._v(\"请求方式必须是指定方式\")]),s._v(\" \"),t(\"td\",[s._v(\"- Method=GET,POST\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",[t(\"strong\",[s._v(\"Path\")])]),s._v(\" \"),t(\"td\",[s._v(\"请求路径必须符合指定规则\")]),s._v(\" \"),t(\"td\",[s._v(\"- Path=/red/{segment},/blue/**\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",[s._v(\"Query\")]),s._v(\" \"),t(\"td\",[s._v(\"请求参数必须包含指定参数\")]),s._v(\" \"),t(\"td\",[s._v(\"- Query=name, Jack或者-  Query=name\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",[s._v(\"RemoteAddr\")]),s._v(\" \"),t(\"td\",[s._v(\"请求者的ip必须是指定范围\")]),s._v(\" \"),t(\"td\",[s._v(\"- RemoteAddr=192.168.1.1/24\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",[s._v(\"Weight\")]),s._v(\" \"),t(\"td\",[s._v(\"权重处理\")]),s._v(\" \"),t(\"td\")])])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"我们只需要掌握 Path 这种路由工程就可以了。\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_3-4-过滤器工厂\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-4-过滤器工厂\"}},[s._v(\"#\")]),s._v(\" 3.4 过滤器工厂\")]),s._v(\" \"),t(\"p\",[s._v(\"Gateway Filter 是网关中提供的一种过滤器，可以对进入网关的\"),t(\"strong\",[s._v(\"请求\")]),s._v(\"和微服务返回的\"),t(\"strong\",[s._v(\"响应\")]),s._v(\"做处理：\")]),s._v(\" \"),t(\"img\",{staticStyle:{zoom:\"80%\"},attrs:{src:\"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210714212312871.png\",alt:\"image-20210714212312871\"}}),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"注意包括了请求\"),t(\"strong\",[s._v(\"和响应\")]),s._v(\"。\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"_3-4-1-路由过滤器的种类\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-4-1-路由过滤器的种类\"}},[s._v(\"#\")]),s._v(\" 3.4.1 路由过滤器的种类\")]),s._v(\" \"),t(\"p\",[s._v(\"Spring Cloud 提供了 31 种不同的路由过滤器工厂。例如：\")]),s._v(\" \"),t(\"table\",[t(\"thead\",[t(\"tr\",[t(\"th\",[s._v(\"名称\")]),s._v(\" \"),t(\"th\",[s._v(\"说明\")])])]),s._v(\" \"),t(\"tbody\",[t(\"tr\",[t(\"td\",[s._v(\"AddRequestHeader\")]),s._v(\" \"),t(\"td\",[s._v(\"给当前请求添加一个请求头\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",[s._v(\"RemoveRequestHeader\")]),s._v(\" \"),t(\"td\",[s._v(\"移除请求中的一个请求头\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",[s._v(\"AddResponseHeader\")]),s._v(\" \"),t(\"td\",[s._v(\"给响应结果中添加一个响应头\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",[s._v(\"RemoveResponseHeader\")]),s._v(\" \"),t(\"td\",[s._v(\"从响应结果中移除有一个响应头\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",[s._v(\"RequestRateLimiter\")]),s._v(\" \"),t(\"td\",[s._v(\"限制请求的流量\")])])])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"_3-4-2-请求头过滤器\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-4-2-请求头过滤器\"}},[s._v(\"#\")]),s._v(\" 3.4.2 请求头过滤器\")]),s._v(\" \"),t(\"p\",[s._v(\"下面我们以 \"),t(\"code\",[s._v(\"AddRequestHeader\")]),s._v(\" 为例来讲解。需求：给所有进入 userservice的请求添加一个请求头：\"),t(\"code\",[s._v(\"Truth=yubin is freaking awesome!\")])]),s._v(\" \"),t(\"p\",[s._v(\"只需要修改 Gateway 服务的 application.yml 文件，添加路由过滤即可：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-yaml line-numbers-mode\"},[t(\"div\",{staticClass:\"highlight-lines\"},[t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"div\",{staticClass:\"highlighted\"},[s._v(\" \")]),t(\"br\")]),t(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"spring\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"cloud\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"gateway\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"routes\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"id\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" user\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\"service \\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"uri\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" lb\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"//userservice \\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"predicates\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" Path=/user/\"),t(\"span\",{pre:!0,attrs:{class:\"token important\"}},[s._v(\"**\")]),s._v(\" \\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"filters\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 过滤器\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" AddRequestHeader=Truth\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" yubin is freaking awesome\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s._v(\"!\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 添加请求头\")]),s._v(\"\\n\")])]),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"当前过滤器写在 userservice 路由下，因此仅仅对访问 userservice 的请求有效。\")])]),s._v(\" \"),t(\"p\",[s._v(\"如果要对所有的路由都生效，则可以将过滤器工厂写到 default 下：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-yaml line-numbers-mode\"},[t(\"div\",{staticClass:\"highlight-lines\"},[t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"br\"),t(\"div\",{staticClass:\"highlighted\"},[s._v(\" \")]),t(\"br\"),t(\"br\")]),t(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"spring\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"cloud\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"gateway\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"routes\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"id\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" user\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\"service \\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"uri\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" lb\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"//userservice \\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"predicates\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" Path=/user/\"),t(\"span\",{pre:!0,attrs:{class:\"token important\"}},[s._v(\"**\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"default-filters\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 默认过滤项\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" AddRequestHeader=Truth\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" yubin is freaking awesome\"),t(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s._v(\"!\")]),s._v(\" \\n\")])]),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\")])]),t(\"h3\",{attrs:{id:\"_3-5-全局过滤器\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-5-全局过滤器\"}},[s._v(\"#\")]),s._v(\" 3.5 全局过滤器\")]),s._v(\" \"),t(\"blockquote\",[t(\"p\",[s._v(\"上一节学习的过滤器，网关提供了 31 种，但每一种过滤器的作用都是固定的。如果我们希望拦截请求，做自己的业务逻辑则没办法实现。\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"_3-5-1-全局过滤器的作用\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-5-1-全局过滤器的作用\"}},[s._v(\"#\")]),s._v(\" 3.5.1 全局过滤器的作用\")]),s._v(\" \"),t(\"p\",[s._v(\"全局过滤器的作用也是处理一切进入网关的请求和微服务响应，与 Gateway Filter 的作用一样。区别在于 Gateway Filter 通过配置定义，处理逻辑是固定的；而 Global Filter 的\"),t(\"strong\",[s._v(\"逻辑需要自己写代码实现\")]),s._v(\"。\")]),s._v(\" \"),t(\"p\",[s._v(\"定义方式是实现 Global Filter 接口：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-java line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"public\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"interface\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"GlobalFilter\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"/**\\n     *  处理当前请求，有必要的话通过{@link GatewayFilterChain}将请求交给下一个过滤器处理\\n     *\\n     * @param exchange 请求上下文，里面可以获取Request、Response等信息\\n     * @param chain 用来把请求委托给下一个过滤器 \\n     * @return {@code Mono<Void>} 返回标示当前过滤器业务结束\\n     */\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Mono\")]),t(\"span\",{pre:!0,attrs:{class:\"token generics\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Void\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"filter\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"ServerWebExchange\")]),s._v(\" exchange\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"GatewayFilterChain\")]),s._v(\" chain\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\")])]),t(\"p\",[s._v(\"在 filter 中编写自定义逻辑，可以实现下列功能：\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"登录状态判断\")]),s._v(\" \"),t(\"li\",[s._v(\"权限校验\")]),s._v(\" \"),t(\"li\",[s._v(\"请求限流等\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"_3-5-2-自定义全局过滤器\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-5-2-自定义全局过滤器\"}},[s._v(\"#\")]),s._v(\" 3.5.2 自定义全局过滤器\")]),s._v(\" \"),t(\"p\",[s._v(\"需求：定义全局过滤器，拦截请求，判断请求的参数是否满足下面条件：\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[t(\"p\",[s._v(\"参数中是否有authorization，\")])]),s._v(\" \"),t(\"li\",[t(\"p\",[s._v(\"authorization参数值是否为admin\")])])]),s._v(\" \"),t(\"p\",[s._v(\"如果同时满足则放行，否则拦截。\")]),s._v(\" \"),t(\"p\",[t(\"strong\",[s._v(\"实现\")]),s._v(\"：在 Gateway 中定义一个过滤器：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-java line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"package\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token namespace\"}},[s._v(\"cn\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"itcast\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"gateway\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"filters\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"import\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token import\"}},[t(\"span\",{pre:!0,attrs:{class:\"token namespace\"}},[s._v(\"org\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"springframework\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"cloud\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"gateway\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"filter\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")])]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"GatewayFilterChain\")])]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"import\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token import\"}},[t(\"span\",{pre:!0,attrs:{class:\"token namespace\"}},[s._v(\"org\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"springframework\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"cloud\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"gateway\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"filter\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")])]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"GlobalFilter\")])]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"import\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token import\"}},[t(\"span\",{pre:!0,attrs:{class:\"token namespace\"}},[s._v(\"org\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"springframework\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"core\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"annotation\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")])]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Order\")])]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"import\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token import\"}},[t(\"span\",{pre:!0,attrs:{class:\"token namespace\"}},[s._v(\"org\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"springframework\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"http\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")])]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"HttpStatus\")])]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"import\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token import\"}},[t(\"span\",{pre:!0,attrs:{class:\"token namespace\"}},[s._v(\"org\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"springframework\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"stereotype\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")])]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Component\")])]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"import\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token import\"}},[t(\"span\",{pre:!0,attrs:{class:\"token namespace\"}},[s._v(\"org\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"springframework\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"web\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"server\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")])]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"ServerWebExchange\")])]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"import\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token import\"}},[t(\"span\",{pre:!0,attrs:{class:\"token namespace\"}},[s._v(\"reactor\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"core\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),s._v(\"publisher\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")])]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Mono\")])]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@Order\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"-\")]),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@Component\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"public\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"class\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"AuthorizeFilter\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"implements\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"GlobalFilter\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[s._v(\"@Override\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"public\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Mono\")]),t(\"span\",{pre:!0,attrs:{class:\"token generics\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Void\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"filter\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"ServerWebExchange\")]),s._v(\" exchange\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"GatewayFilterChain\")]),s._v(\" chain\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// 1.获取请求参数\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"MultiValueMap\")]),t(\"span\",{pre:!0,attrs:{class:\"token generics\"}},[t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"<\")]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"String\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"String\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")])]),s._v(\" params \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" exchange\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"getRequest\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"getQueryParams\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// 2.获取authorization参数\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"String\")]),s._v(\" auth \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" params\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"getFirst\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"authorization\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// 3.校验\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"if\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"admin\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"equals\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"auth\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n            \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// 放行\")]),s._v(\"\\n            \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"return\")]),s._v(\" chain\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"filter\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"exchange\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// 4.拦截\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// 4.1.禁止访问，设置状态码\")]),s._v(\"\\n        exchange\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"getResponse\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"setStatusCode\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"HttpStatus\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token constant\"}},[s._v(\"FORBIDDEN\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// 4.2.结束处理\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"return\")]),s._v(\" exchange\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"getResponse\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"setComplete\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"23\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"24\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"25\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"26\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"27\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"28\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"29\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"30\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"31\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"_3-5-3-过滤器执行顺序\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-5-3-过滤器执行顺序\"}},[s._v(\"#\")]),s._v(\" 3.5.3 过滤器执行顺序\")]),s._v(\" \"),t(\"p\",[s._v(\"请求进入网关会碰到三类过滤器：当前路由的过滤器、DefaultFilter、GlobalFilter。\")]),s._v(\" \"),t(\"img\",{staticStyle:{zoom:\"67%\"},attrs:{src:\"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210714214228409.png\",alt:\"image-20210714214228409\"}}),s._v(\" \"),t(\"p\",[s._v(\"排序规则：\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"每一个过滤器都必须指定一个 int 类型的 order 值，\"),t(\"strong\",[s._v(\"order 值越小，优先级越高，执行顺序越靠前\")]),s._v(\"。\")]),s._v(\" \"),t(\"li\",[s._v(\"GlobalFilter 通过实现 Ordered 接口，或者添加 @Order 注解来指定order值，由我们自己指定。\")]),s._v(\" \"),t(\"li\",[s._v(\"路由过滤器和 defaultFilter 的 order 由 Spring 指定，默认是按照声明顺序从 1 递增。\")]),s._v(\" \"),t(\"li\",[s._v(\"当过滤器的order值一样时，会按照 defaultFilter > 路由过滤器 > GlobalFilter的顺序执行。\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_3-6-跨域问题\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-6-跨域问题\"}},[s._v(\"#\")]),s._v(\" 3.6 跨域问题\")]),s._v(\" \"),t(\"p\",[s._v(\"跨域问题：\"),t(\"strong\",[s._v(\"浏览器\")]),s._v(\"禁止请求的发起者与服务端发生跨域 Ajax 请求，请求被浏览器拦截的问题。\")]),s._v(\" \"),t(\"p\",[s._v(\"解决方案：\"),t(\"strong\",[s._v(\"CORS\")]),s._v(\"。\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"_3-6-1-解决跨域问题\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-6-1-解决跨域问题\"}},[s._v(\"#\")]),s._v(\" 3.6.1 解决跨域问题\")]),s._v(\" \"),t(\"p\",[s._v(\"网关处理跨域采用的同样是 CORS 方案，在 Gateway 服务的 application.yml 文件中，添加下面的配置：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-yaml line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"spring\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"cloud\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"gateway\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 。。。\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"globalcors\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 全局的跨域处理\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"add-to-simple-url-handler-mapping\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token boolean important\"}},[s._v(\"true\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 解决options请求被拦截问题\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"corsConfigurations\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n          \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"'[/**]'\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n            \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"allowedOrigins\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 允许哪些网站的跨域请求 \")]),s._v(\"\\n              \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"http://localhost:8090\"')]),s._v(\"\\n            \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"allowedMethods\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 允许的跨域ajax的请求方式\")]),s._v(\"\\n              \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"GET\"')]),s._v(\"\\n              \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"POST\"')]),s._v(\"\\n              \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"DELETE\"')]),s._v(\"\\n              \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"PUT\"')]),s._v(\"\\n              \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"OPTIONS\"')]),s._v(\"\\n            \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"allowedHeaders\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"*\"')]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 允许在请求中携带的头信息\")]),s._v(\"\\n            \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"allowCredentials\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token boolean important\"}},[s._v(\"true\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 是否允许携带cookie\")]),s._v(\"\\n            \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"maxAge\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"360000\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 这次跨域检测的有效期\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),t(\"br\")])])])}),[],!1,null,null,null);t.default=e.exports}}]);","extractedComments":[]}