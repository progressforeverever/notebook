<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring Cloud 快速入门 1：概述与注册中心 | notebook</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/notebook/img/favicon.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="学习笔记">
    <meta name="keywords" content="全栈学习笔记">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/notebook/assets/css/0.styles.306676b6.css" as="style"><link rel="preload" href="/notebook/assets/js/app.8978aa11.js" as="script"><link rel="preload" href="/notebook/assets/js/2.3295585a.js" as="script"><link rel="preload" href="/notebook/assets/js/94.1cfba720.js" as="script"><link rel="prefetch" href="/notebook/assets/js/10.ad0dd013.js"><link rel="prefetch" href="/notebook/assets/js/100.18d762e6.js"><link rel="prefetch" href="/notebook/assets/js/101.df1643fc.js"><link rel="prefetch" href="/notebook/assets/js/102.711fb094.js"><link rel="prefetch" href="/notebook/assets/js/103.df90361a.js"><link rel="prefetch" href="/notebook/assets/js/104.91cc5537.js"><link rel="prefetch" href="/notebook/assets/js/105.5faf1761.js"><link rel="prefetch" href="/notebook/assets/js/106.d4373ca9.js"><link rel="prefetch" href="/notebook/assets/js/107.09e7e977.js"><link rel="prefetch" href="/notebook/assets/js/108.f879ec06.js"><link rel="prefetch" href="/notebook/assets/js/109.d73ab4a7.js"><link rel="prefetch" href="/notebook/assets/js/11.bb942f67.js"><link rel="prefetch" href="/notebook/assets/js/110.df1195c3.js"><link rel="prefetch" href="/notebook/assets/js/111.aad6f628.js"><link rel="prefetch" href="/notebook/assets/js/112.6608ef6c.js"><link rel="prefetch" href="/notebook/assets/js/113.b44d7a9d.js"><link rel="prefetch" href="/notebook/assets/js/114.32d718f1.js"><link rel="prefetch" href="/notebook/assets/js/115.fc120a9e.js"><link rel="prefetch" href="/notebook/assets/js/116.b59b2c90.js"><link rel="prefetch" href="/notebook/assets/js/117.e06a792c.js"><link rel="prefetch" href="/notebook/assets/js/118.81328820.js"><link rel="prefetch" href="/notebook/assets/js/119.8bd5b49e.js"><link rel="prefetch" href="/notebook/assets/js/12.0084f935.js"><link rel="prefetch" href="/notebook/assets/js/120.75e8278b.js"><link rel="prefetch" href="/notebook/assets/js/121.7645aa3b.js"><link rel="prefetch" href="/notebook/assets/js/122.12da3625.js"><link rel="prefetch" href="/notebook/assets/js/123.54772ef5.js"><link rel="prefetch" href="/notebook/assets/js/124.0f435a4e.js"><link rel="prefetch" href="/notebook/assets/js/125.49202e31.js"><link rel="prefetch" href="/notebook/assets/js/126.063c0dc0.js"><link rel="prefetch" href="/notebook/assets/js/127.10aef89a.js"><link rel="prefetch" href="/notebook/assets/js/128.a18fb938.js"><link rel="prefetch" href="/notebook/assets/js/129.52bd3fa2.js"><link rel="prefetch" href="/notebook/assets/js/13.1518aee3.js"><link rel="prefetch" href="/notebook/assets/js/130.94b09c35.js"><link rel="prefetch" href="/notebook/assets/js/131.8e8741cd.js"><link rel="prefetch" href="/notebook/assets/js/132.6039f04a.js"><link rel="prefetch" href="/notebook/assets/js/133.5d5a881e.js"><link rel="prefetch" href="/notebook/assets/js/134.13c96cab.js"><link rel="prefetch" href="/notebook/assets/js/135.84ff1026.js"><link rel="prefetch" href="/notebook/assets/js/136.5be2d64f.js"><link rel="prefetch" href="/notebook/assets/js/137.c13ade8c.js"><link rel="prefetch" href="/notebook/assets/js/138.245b4b27.js"><link rel="prefetch" href="/notebook/assets/js/139.c8ce5977.js"><link rel="prefetch" href="/notebook/assets/js/14.65893aa1.js"><link rel="prefetch" href="/notebook/assets/js/140.162d1bb5.js"><link rel="prefetch" href="/notebook/assets/js/141.f6f6fa8d.js"><link rel="prefetch" href="/notebook/assets/js/142.558f939a.js"><link rel="prefetch" href="/notebook/assets/js/143.bd02ec09.js"><link rel="prefetch" href="/notebook/assets/js/144.e23e68a5.js"><link rel="prefetch" href="/notebook/assets/js/145.ebbca7e4.js"><link rel="prefetch" href="/notebook/assets/js/146.e5c44244.js"><link rel="prefetch" href="/notebook/assets/js/147.9f7ccbfc.js"><link rel="prefetch" href="/notebook/assets/js/148.a367286f.js"><link rel="prefetch" href="/notebook/assets/js/149.04cfb13d.js"><link rel="prefetch" href="/notebook/assets/js/15.94d642c1.js"><link rel="prefetch" href="/notebook/assets/js/150.449a26e9.js"><link rel="prefetch" href="/notebook/assets/js/151.8fd3a27b.js"><link rel="prefetch" href="/notebook/assets/js/152.3b529668.js"><link rel="prefetch" href="/notebook/assets/js/153.fa86f4c0.js"><link rel="prefetch" href="/notebook/assets/js/154.60a24941.js"><link rel="prefetch" href="/notebook/assets/js/155.6d661985.js"><link rel="prefetch" href="/notebook/assets/js/156.b9cc9d16.js"><link rel="prefetch" href="/notebook/assets/js/157.418f5bf3.js"><link rel="prefetch" href="/notebook/assets/js/158.42495e4b.js"><link rel="prefetch" href="/notebook/assets/js/159.c42f7bdc.js"><link rel="prefetch" href="/notebook/assets/js/16.f82ad78e.js"><link rel="prefetch" href="/notebook/assets/js/160.063519a2.js"><link rel="prefetch" href="/notebook/assets/js/161.acf0704e.js"><link rel="prefetch" href="/notebook/assets/js/162.603af965.js"><link rel="prefetch" href="/notebook/assets/js/163.ae82d304.js"><link rel="prefetch" href="/notebook/assets/js/164.23ac592d.js"><link rel="prefetch" href="/notebook/assets/js/165.2b97d44b.js"><link rel="prefetch" href="/notebook/assets/js/166.2318947e.js"><link rel="prefetch" href="/notebook/assets/js/167.c379c56d.js"><link rel="prefetch" href="/notebook/assets/js/168.8d1a7c3a.js"><link rel="prefetch" href="/notebook/assets/js/169.1893572a.js"><link rel="prefetch" href="/notebook/assets/js/17.8ffa6c64.js"><link rel="prefetch" href="/notebook/assets/js/170.2b80b7bd.js"><link rel="prefetch" href="/notebook/assets/js/171.1e896c70.js"><link rel="prefetch" href="/notebook/assets/js/172.5f6aa7cb.js"><link rel="prefetch" href="/notebook/assets/js/173.ea3e6be3.js"><link rel="prefetch" href="/notebook/assets/js/174.2b42017e.js"><link rel="prefetch" href="/notebook/assets/js/175.612d3b13.js"><link rel="prefetch" href="/notebook/assets/js/176.bb131f2a.js"><link rel="prefetch" href="/notebook/assets/js/177.8ec26f15.js"><link rel="prefetch" href="/notebook/assets/js/178.a14f0a09.js"><link rel="prefetch" href="/notebook/assets/js/179.43bc8d77.js"><link rel="prefetch" href="/notebook/assets/js/18.72d19e8c.js"><link rel="prefetch" href="/notebook/assets/js/180.b86fc5fc.js"><link rel="prefetch" href="/notebook/assets/js/181.4682b920.js"><link rel="prefetch" href="/notebook/assets/js/182.d13f6ea1.js"><link rel="prefetch" href="/notebook/assets/js/183.15ae06b7.js"><link rel="prefetch" href="/notebook/assets/js/184.26601145.js"><link rel="prefetch" href="/notebook/assets/js/185.24f2484e.js"><link rel="prefetch" href="/notebook/assets/js/186.9c57a6bd.js"><link rel="prefetch" href="/notebook/assets/js/187.49c1ccaf.js"><link rel="prefetch" href="/notebook/assets/js/188.d36e089d.js"><link rel="prefetch" href="/notebook/assets/js/189.c9c05468.js"><link rel="prefetch" href="/notebook/assets/js/19.9fc8ebe6.js"><link rel="prefetch" href="/notebook/assets/js/190.a3bf651a.js"><link rel="prefetch" href="/notebook/assets/js/191.764e02c7.js"><link rel="prefetch" href="/notebook/assets/js/192.efbc422a.js"><link rel="prefetch" href="/notebook/assets/js/193.2378c3df.js"><link rel="prefetch" href="/notebook/assets/js/194.4c58d88b.js"><link rel="prefetch" href="/notebook/assets/js/195.badf2826.js"><link rel="prefetch" href="/notebook/assets/js/196.b8c6de79.js"><link rel="prefetch" href="/notebook/assets/js/197.d605bd64.js"><link rel="prefetch" href="/notebook/assets/js/198.7f351da5.js"><link rel="prefetch" href="/notebook/assets/js/199.18ac70dc.js"><link rel="prefetch" href="/notebook/assets/js/20.ae5f6787.js"><link rel="prefetch" href="/notebook/assets/js/200.4dc7a625.js"><link rel="prefetch" href="/notebook/assets/js/201.86bc1624.js"><link rel="prefetch" href="/notebook/assets/js/202.46f431ad.js"><link rel="prefetch" href="/notebook/assets/js/203.e422dce0.js"><link rel="prefetch" href="/notebook/assets/js/204.1e8ff98b.js"><link rel="prefetch" href="/notebook/assets/js/205.160f2d88.js"><link rel="prefetch" href="/notebook/assets/js/206.b8bb9eb0.js"><link rel="prefetch" href="/notebook/assets/js/207.2d979a2c.js"><link rel="prefetch" href="/notebook/assets/js/208.57c8bde5.js"><link rel="prefetch" href="/notebook/assets/js/209.34c6c965.js"><link rel="prefetch" href="/notebook/assets/js/21.4d8cf05c.js"><link rel="prefetch" href="/notebook/assets/js/210.5184efc3.js"><link rel="prefetch" href="/notebook/assets/js/211.27b3c43f.js"><link rel="prefetch" href="/notebook/assets/js/212.6ca80d46.js"><link rel="prefetch" href="/notebook/assets/js/213.006099ab.js"><link rel="prefetch" href="/notebook/assets/js/214.01d10125.js"><link rel="prefetch" href="/notebook/assets/js/215.fe553758.js"><link rel="prefetch" href="/notebook/assets/js/216.2451d652.js"><link rel="prefetch" href="/notebook/assets/js/217.10acfce9.js"><link rel="prefetch" href="/notebook/assets/js/22.8847f393.js"><link rel="prefetch" href="/notebook/assets/js/23.38076e6c.js"><link rel="prefetch" href="/notebook/assets/js/24.241b5ba4.js"><link rel="prefetch" href="/notebook/assets/js/25.d555f519.js"><link rel="prefetch" href="/notebook/assets/js/26.5e596b6c.js"><link rel="prefetch" href="/notebook/assets/js/27.2c4bffc6.js"><link rel="prefetch" href="/notebook/assets/js/28.bf68cc5f.js"><link rel="prefetch" href="/notebook/assets/js/29.1850bb08.js"><link rel="prefetch" href="/notebook/assets/js/3.ea1a4511.js"><link rel="prefetch" href="/notebook/assets/js/30.913c71ed.js"><link rel="prefetch" href="/notebook/assets/js/31.8c1368e4.js"><link rel="prefetch" href="/notebook/assets/js/32.ab4a79e6.js"><link rel="prefetch" href="/notebook/assets/js/33.67c2d1e1.js"><link rel="prefetch" href="/notebook/assets/js/34.8d4fe674.js"><link rel="prefetch" href="/notebook/assets/js/35.1dd47348.js"><link rel="prefetch" href="/notebook/assets/js/36.4f00b90e.js"><link rel="prefetch" href="/notebook/assets/js/37.f2f08452.js"><link rel="prefetch" href="/notebook/assets/js/38.85d5f4b1.js"><link rel="prefetch" href="/notebook/assets/js/39.68430cda.js"><link rel="prefetch" href="/notebook/assets/js/4.aa1f4d87.js"><link rel="prefetch" href="/notebook/assets/js/40.a5d1602d.js"><link rel="prefetch" href="/notebook/assets/js/41.f9003dd4.js"><link rel="prefetch" href="/notebook/assets/js/42.b9468304.js"><link rel="prefetch" href="/notebook/assets/js/43.5b698cbc.js"><link rel="prefetch" href="/notebook/assets/js/44.5d66646e.js"><link rel="prefetch" href="/notebook/assets/js/45.d8c25634.js"><link rel="prefetch" href="/notebook/assets/js/46.3a29e957.js"><link rel="prefetch" href="/notebook/assets/js/47.10a47405.js"><link rel="prefetch" href="/notebook/assets/js/48.b7787ca9.js"><link rel="prefetch" href="/notebook/assets/js/49.a435f028.js"><link rel="prefetch" href="/notebook/assets/js/5.a042e532.js"><link rel="prefetch" href="/notebook/assets/js/50.377b1218.js"><link rel="prefetch" href="/notebook/assets/js/51.72238a50.js"><link rel="prefetch" href="/notebook/assets/js/52.d5eeb5ab.js"><link rel="prefetch" href="/notebook/assets/js/53.ad4d5c5e.js"><link rel="prefetch" href="/notebook/assets/js/54.fa68e4d3.js"><link rel="prefetch" href="/notebook/assets/js/55.6758b457.js"><link rel="prefetch" href="/notebook/assets/js/56.f1178984.js"><link rel="prefetch" href="/notebook/assets/js/57.49bfa3ec.js"><link rel="prefetch" href="/notebook/assets/js/58.25693284.js"><link rel="prefetch" href="/notebook/assets/js/59.355865a0.js"><link rel="prefetch" href="/notebook/assets/js/6.744ef3d9.js"><link rel="prefetch" href="/notebook/assets/js/60.3b04c778.js"><link rel="prefetch" href="/notebook/assets/js/61.5c730da5.js"><link rel="prefetch" href="/notebook/assets/js/62.293977a9.js"><link rel="prefetch" href="/notebook/assets/js/63.a1f7d522.js"><link rel="prefetch" href="/notebook/assets/js/64.698160c8.js"><link rel="prefetch" href="/notebook/assets/js/65.2d400d32.js"><link rel="prefetch" href="/notebook/assets/js/66.9e1d1088.js"><link rel="prefetch" href="/notebook/assets/js/67.0a49ac07.js"><link rel="prefetch" href="/notebook/assets/js/68.e278f8bd.js"><link rel="prefetch" href="/notebook/assets/js/69.9ae024f0.js"><link rel="prefetch" href="/notebook/assets/js/7.a8cc7006.js"><link rel="prefetch" href="/notebook/assets/js/70.ecc66a1b.js"><link rel="prefetch" href="/notebook/assets/js/71.6197564c.js"><link rel="prefetch" href="/notebook/assets/js/72.8a51c5a8.js"><link rel="prefetch" href="/notebook/assets/js/73.17b7fc55.js"><link rel="prefetch" href="/notebook/assets/js/74.51c25099.js"><link rel="prefetch" href="/notebook/assets/js/75.4e49385e.js"><link rel="prefetch" href="/notebook/assets/js/76.9b20af8b.js"><link rel="prefetch" href="/notebook/assets/js/77.62682a06.js"><link rel="prefetch" href="/notebook/assets/js/78.b3326b2e.js"><link rel="prefetch" href="/notebook/assets/js/79.69dde82f.js"><link rel="prefetch" href="/notebook/assets/js/8.d3830af8.js"><link rel="prefetch" href="/notebook/assets/js/80.d5950484.js"><link rel="prefetch" href="/notebook/assets/js/81.2dab3637.js"><link rel="prefetch" href="/notebook/assets/js/82.f4d136fc.js"><link rel="prefetch" href="/notebook/assets/js/83.c7d751a8.js"><link rel="prefetch" href="/notebook/assets/js/84.b2645137.js"><link rel="prefetch" href="/notebook/assets/js/85.02ecd4f2.js"><link rel="prefetch" href="/notebook/assets/js/86.6d6d39be.js"><link rel="prefetch" href="/notebook/assets/js/87.dfdc8e09.js"><link rel="prefetch" href="/notebook/assets/js/88.4d5bde3b.js"><link rel="prefetch" href="/notebook/assets/js/89.5b14e392.js"><link rel="prefetch" href="/notebook/assets/js/9.799b4b95.js"><link rel="prefetch" href="/notebook/assets/js/90.c16fd700.js"><link rel="prefetch" href="/notebook/assets/js/91.23c01f88.js"><link rel="prefetch" href="/notebook/assets/js/92.e7a0e511.js"><link rel="prefetch" href="/notebook/assets/js/93.0616815a.js"><link rel="prefetch" href="/notebook/assets/js/95.cd76aaad.js"><link rel="prefetch" href="/notebook/assets/js/96.44646498.js"><link rel="prefetch" href="/notebook/assets/js/97.9e696d9d.js"><link rel="prefetch" href="/notebook/assets/js/98.e9f8b933.js"><link rel="prefetch" href="/notebook/assets/js/99.95e727c2.js">
    <link rel="stylesheet" href="/notebook/assets/css/0.styles.306676b6.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notebook/" class="home-link router-link-active"><img src="/notebook/img/logo.jpg" alt="notebook" class="logo"> <span class="site-name can-hide">notebook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notebook/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><!----> <span class="title" style="display:;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/fontEnd/html/" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/notebook/fontEnd/javascript/" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/notebook/fontEnd/Vue/" class="nav-link">Vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java" class="dropdown-title"><!----> <span class="title" style="display:;">java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/java/javaSE/" class="nav-link">javaSE</a></li><li class="dropdown-item"><!----> <a href="/notebook/java/maven/" class="nav-link">maven</a></li><li class="dropdown-item"><!----> <a href="/notebook/java/git/" class="nav-link">git</a></li><li class="dropdown-item"><!----> <a href="/notebook/java/springboot/" class="nav-link">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/notebook/java/Spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/notebook/java/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-item"><!----> <a href="/notebook/java/SpringSecurity/" class="nav-link">SpringSecurity</a></li><li class="dropdown-item"><!----> <a href="/notebook/java/DesignPattern/" class="nav-link">DesignPattern</a></li><li class="dropdown-item"><!----> <a href="/notebook/java/DevelopAndReading/" class="nav-link">开发与阅读</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="python" class="dropdown-title"><!----> <span class="title" style="display:;">python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/python/pythonFundamentals/" class="nav-link">pythonFundamentals</a></li><li class="dropdown-item"><!----> <a href="/notebook/python/fastAPI/" class="nav-link">fastAPI</a></li><li class="dropdown-item"><!----> <a href="/notebook/python/Flask/" class="nav-link">Flask</a></li><li class="dropdown-item"><!----> <a href="/notebook/python/spider/" class="nav-link">爬虫</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><!----> <span class="title" style="display:;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/ops/linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/notebook/ops/docker/" class="nav-link">docker</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库与中间件" class="dropdown-title"><!----> <span class="title" style="display:;">数据库与中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/database/MySQL/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/notebook/database/MongoDB/" class="nav-link">MongoDB</a></li><li class="dropdown-item"><!----> <a href="/notebook/database/Redis/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/notebook/database/Elatisearch/" class="nav-link">Elatisearch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><!----> <span class="title" style="display:;">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/foundation/Leetcode/" class="nav-link">Leetcode</a></li><li class="dropdown-item"><!----> <a href="/notebook/foundation/os/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/notebook/foundation/network/" class="nav-link">计算机网络</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://czynotebook.oss-cn-beijing.aliyuncs.com/%E4%BE%A7%E8%BE%B9%E6%A0%8F.jpeg"> <div class="blogger-info"><h3>学习笔记</h3> <span>每个小菜鸡都有变强的梦想</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/notebook/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><!----> <span class="title" style="display:;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/fontEnd/html/" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/notebook/fontEnd/javascript/" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/notebook/fontEnd/Vue/" class="nav-link">Vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java" class="dropdown-title"><!----> <span class="title" style="display:;">java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/java/javaSE/" class="nav-link">javaSE</a></li><li class="dropdown-item"><!----> <a href="/notebook/java/maven/" class="nav-link">maven</a></li><li class="dropdown-item"><!----> <a href="/notebook/java/git/" class="nav-link">git</a></li><li class="dropdown-item"><!----> <a href="/notebook/java/springboot/" class="nav-link">SpringBoot</a></li><li class="dropdown-item"><!----> <a href="/notebook/java/Spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/notebook/java/SpringCloud/" class="nav-link">SpringCloud</a></li><li class="dropdown-item"><!----> <a href="/notebook/java/SpringSecurity/" class="nav-link">SpringSecurity</a></li><li class="dropdown-item"><!----> <a href="/notebook/java/DesignPattern/" class="nav-link">DesignPattern</a></li><li class="dropdown-item"><!----> <a href="/notebook/java/DevelopAndReading/" class="nav-link">开发与阅读</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="python" class="dropdown-title"><!----> <span class="title" style="display:;">python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/python/pythonFundamentals/" class="nav-link">pythonFundamentals</a></li><li class="dropdown-item"><!----> <a href="/notebook/python/fastAPI/" class="nav-link">fastAPI</a></li><li class="dropdown-item"><!----> <a href="/notebook/python/Flask/" class="nav-link">Flask</a></li><li class="dropdown-item"><!----> <a href="/notebook/python/spider/" class="nav-link">爬虫</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><!----> <span class="title" style="display:;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/ops/linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/notebook/ops/docker/" class="nav-link">docker</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库与中间件" class="dropdown-title"><!----> <span class="title" style="display:;">数据库与中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/database/MySQL/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/notebook/database/MongoDB/" class="nav-link">MongoDB</a></li><li class="dropdown-item"><!----> <a href="/notebook/database/Redis/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/notebook/database/Elatisearch/" class="nav-link">Elatisearch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><!----> <span class="title" style="display:;">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/foundation/Leetcode/" class="nav-link">Leetcode</a></li><li class="dropdown-item"><!----> <a href="/notebook/foundation/os/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/notebook/foundation/network/" class="nav-link">计算机网络</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javaSE</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>maven</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>SpringCloud</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notebook/pages/833cd8/" class="sidebar-link">SpringCloud微服务初识</a></li><li><a href="/notebook/pages/0b7942/" aria-current="page" class="active sidebar-link">Spring Cloud 快速入门 1：概述与注册中心</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/notebook/pages/0b7942/#_1-认识微服务" class="sidebar-link">1. 认识微服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/0b7942/#_1-1-单体架构与分布式架构" class="sidebar-link">1.1 单体架构与分布式架构</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0b7942/#_1-2-微服务" class="sidebar-link">1.2 微服务</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0b7942/#_1-3-spring-cloud" class="sidebar-link">1.3 Spring Cloud</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/notebook/pages/0b7942/#_2-服务拆分和远程调用" class="sidebar-link">2. 服务拆分和远程调用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/0b7942/#_2-1-服务拆分原则" class="sidebar-link">2.1 服务拆分原则</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0b7942/#_2-2-服务拆分示例" class="sidebar-link">2.2 服务拆分示例</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0b7942/#_2-3-远程调用案例" class="sidebar-link">2.3 远程调用案例</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0b7942/#_2-4-提供者与消费者" class="sidebar-link">2.4 提供者与消费者</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/notebook/pages/0b7942/#_3-eureka-注册中心" class="sidebar-link">3. Eureka 注册中心</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/0b7942/#_3-1-eureka-的结构和作用" class="sidebar-link">3.1 Eureka 的结构和作用</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0b7942/#_3-2-搭建-eureka-server" class="sidebar-link">3.2 搭建 Eureka Server</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0b7942/#_3-3-服务注册" class="sidebar-link">3.3 服务注册</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0b7942/#_3-4-服务发现" class="sidebar-link">3.4 服务发现</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/notebook/pages/0b7942/#_4-ribbon-负载均衡" class="sidebar-link">4. Ribbon 负载均衡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/0b7942/#_4-1-原理分析" class="sidebar-link">4.1 原理分析</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0b7942/#_4-2-负载均衡策略" class="sidebar-link">4.2 负载均衡策略</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0b7942/#_4-3-饥饿加载" class="sidebar-link">4.3 饥饿加载</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/notebook/pages/0b7942/#_5-nacos-注册中心" class="sidebar-link">5. Nacos 注册中心</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/notebook/pages/0b7942/#_5-1-服务注册到-nacos" class="sidebar-link">5.1 服务注册到 nacos</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0b7942/#_5-2-服务分级存储模型" class="sidebar-link">5.2 服务分级存储模型</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0b7942/#_5-3-权重配置" class="sidebar-link">5.3 权重配置</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0b7942/#_5-4-环境隔离" class="sidebar-link">5.4 环境隔离</a></li><li class="sidebar-sub-header level3"><a href="/notebook/pages/0b7942/#_5-5-nacos-与-eureka-的区别" class="sidebar-link">5.5 Nacos 与 Eureka 的区别</a></li></ul></li></ul></li><li><a href="/notebook/pages/fe23e5/" class="sidebar-link">Spring Cloud 快速入门 2：配置管理、远程调用和网关</a></li><li><a href="/notebook/pages/bbdf12/" class="sidebar-link">Spring Cloud 快速入门 3：服务异步通讯</a></li><li><a href="/notebook/pages/6ec84a/" class="sidebar-link">Spring Cloud 快速入门 4：服务保护</a></li><li><a href="/notebook/pages/a4f7d8/" class="sidebar-link">Dubbo</a></li><li><a href="/notebook/pages/b5eb39/" class="sidebar-link">Zookeeper</a></li><li><a href="/notebook/pages/cb50a2/" class="sidebar-link">Sentinel  微服务保护</a></li><li><a href="/notebook/pages/14c4df/" class="sidebar-link">分布式事务</a></li><li><a href="/notebook/pages/0fa6d7/" class="sidebar-link">UUID</a></li><li><a href="/notebook/pages/35c031/" class="sidebar-link">feign到底应该怎么写</a></li><li><a href="/notebook/pages/1a1419/" class="sidebar-link">RabbitMQ</a></li><li><a href="/notebook/pages/c5b954/" class="sidebar-link">RabbitMQ 可靠性</a></li><li><a href="/notebook/pages/cb9907/" class="sidebar-link">RabbitMQ总结</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringSecurity</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>DesignPattern</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开发与阅读</span> <span class="arrow right"></span></p> <!----></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-6"><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/notebook/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/notebook/categories/?category=java" title="分类" data-v-06225672>java</a></li><li data-v-06225672><a href="/notebook/categories/?category=SpringCloud" title="分类" data-v-06225672>SpringCloud</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/progressforeverever" target="_blank" title="作者" class="beLink" data-v-06225672>czy</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-07-12</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Spring Cloud 快速入门 1：概述与注册中心<!----></h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#_1-认识微服务">1. 认识微服务</a><ul><li><a href="#_1-1-单体架构与分布式架构">1.1 单体架构与分布式架构</a></li><li><a href="#_1-2-微服务">1.2 微服务</a></li><li><a href="#_1-3-spring-cloud">1.3 Spring Cloud</a></li></ul></li><li><a href="#_2-服务拆分和远程调用">2. 服务拆分和远程调用</a><ul><li><a href="#_2-1-服务拆分原则">2.1 服务拆分原则</a></li><li><a href="#_2-2-服务拆分示例">2.2 服务拆分示例</a></li><li><a href="#_2-3-远程调用案例">2.3 远程调用案例</a></li><li><a href="#_2-4-提供者与消费者">2.4 提供者与消费者</a></li></ul></li><li><a href="#_3-eureka-注册中心">3. Eureka 注册中心</a><ul><li><a href="#_3-1-eureka-的结构和作用">3.1 Eureka 的结构和作用</a></li><li><a href="#_3-2-搭建-eureka-server">3.2 搭建 Eureka Server</a></li><li><a href="#_3-3-服务注册">3.3 服务注册</a></li><li><a href="#_3-4-服务发现">3.4 服务发现</a></li></ul></li><li><a href="#_4-ribbon-负载均衡">4. Ribbon 负载均衡</a><ul><li><a href="#_4-1-原理分析">4.1 原理分析</a></li><li><a href="#_4-2-负载均衡策略">4.2 负载均衡策略</a></li><li><a href="#_4-3-饥饿加载">4.3 饥饿加载</a></li></ul></li><li><a href="#_5-nacos-注册中心">5. Nacos 注册中心</a><ul><li><a href="#_5-1-服务注册到-nacos">5.1 服务注册到 nacos</a></li><li><a href="#_5-2-服务分级存储模型">5.2 服务分级存储模型</a></li><li><a href="#_5-3-权重配置">5.3 权重配置</a></li><li><a href="#_5-4-环境隔离">5.4 环境隔离</a></li><li><a href="#_5-5-nacos-与-eureka-的区别">5.5 Nacos 与 Eureka 的区别</a></li></ul></li></ul></div><p></p> <h2 id="_1-认识微服务"><a href="#_1-认识微服务" class="header-anchor">#</a> 1. 认识微服务</h2> <h3 id="_1-1-单体架构与分布式架构"><a href="#_1-1-单体架构与分布式架构" class="header-anchor">#</a> 1.1 单体架构与分布式架构</h3> <p><strong>单体架构</strong>：将业务的所有功能集中在一个项目中开发，打成一个包部署。</p> <ul><li>优点：架构简单，部署成本低</li> <li>缺点：耦合度高（维护困难、升级困难）</li></ul> <p><strong>分布式架构</strong>：根据业务功能对系统做拆分，每个业务功能模块作为独立项目开发，称为一个服务。</p> <ul><li>优点：降低服务耦合，有利于服务升级和拓展</li> <li>缺点：服务调用关系错综复杂</li></ul> <p>分布式架构虽然降低了服务耦合，但是服务拆分时也有很多问题需要思考：</p> <ul><li>服务拆分的粒度如何界定？</li> <li>服务之间如何调用？</li> <li>服务的调用关系如何管理？</li></ul> <h3 id="_1-2-微服务"><a href="#_1-2-微服务" class="header-anchor">#</a> 1.2 微服务</h3> <p>微服务的架构特征：</p> <ul><li>单一职责：微服务拆分粒度更小，每一个服务都对应唯一的业务能力，做到单一职责</li> <li>自治：团队独立、技术独立、数据独立，独立部署和交付</li> <li>面向服务：服务提供统一标准的接口，与语言和技术无关</li> <li>隔离性强：服务调用做好隔离、容错、降级，避免出现级联问题</li></ul> <p><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220305200314698.png" alt="image-20220305200314698"></p> <p>可以认为<strong>微服务</strong>是一种经过良好架构设计的<strong>分布式架构方案</strong> 。</p> <h3 id="_1-3-spring-cloud"><a href="#_1-3-spring-cloud" class="header-anchor">#</a> 1.3 Spring Cloud</h3> <p>Spring Cloud 集成了各种微服务功能组件，并基于 Spring Boot 实现了这些组件的自动装配，从而提供了良好的开箱即用体验。常见的组件如下：</p> <p><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210713204155887.png" alt="image-20210713204155887"></p> <p>我们所学的版本是 Spring Cloud Hoxton.SR10，对应的 Spring Boot 版本是2.3.x版本。</p> <p>微服务技术对比：</p> <table><thead><tr><th style="text-align:center;"></th> <th style="text-align:center;">Dubbo</th> <th style="text-align:center;">Spring Cloud</th> <th style="text-align:center;">Spring Cloud Alibaba</th></tr></thead> <tbody><tr><td style="text-align:center;">注册中心</td> <td style="text-align:center;">zookeeper、Redis</td> <td style="text-align:center;">Eureka、Consul</td> <td style="text-align:center;">Nacos、Eureka</td></tr> <tr><td style="text-align:center;">服务远程调用</td> <td style="text-align:center;">Dubbo协议</td> <td style="text-align:center;">Feign（http协议）</td> <td style="text-align:center;">Dubbo、Feign</td></tr> <tr><td style="text-align:center;">配置中心</td> <td style="text-align:center;">无</td> <td style="text-align:center;">Spring Cloud Config</td> <td style="text-align:center;">Spring Cloud Config、Nacos</td></tr> <tr><td style="text-align:center;">服务网关</td> <td style="text-align:center;">无</td> <td style="text-align:center;">Spring Cloud Gateway、Zuul</td> <td style="text-align:center;">Spring Cloud Gateway、Zuul</td></tr> <tr><td style="text-align:center;">服务监控和保护</td> <td style="text-align:center;">dubbo-admin，功能弱</td> <td style="text-align:center;">Hystix</td> <td style="text-align:center;">Sentinel</td></tr></tbody></table> <p>企业常见应用情况：</p> <p><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220305201206613.png" alt="image-20220305201206613"></p> <h2 id="_2-服务拆分和远程调用"><a href="#_2-服务拆分和远程调用" class="header-anchor">#</a> 2. 服务拆分和远程调用</h2> <h3 id="_2-1-服务拆分原则"><a href="#_2-1-服务拆分原则" class="header-anchor">#</a> 2.1 服务拆分原则</h3> <ul><li>不同微服务，不要重复开发相同业务</li> <li>微服务数据独立，不要访问其它微服务的数据库</li> <li>微服务可以将自己的业务暴露为接口，供其它微服务调用</li></ul> <img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210713210800950.png" alt="image-20210713210800950" style="zoom:50%;"> <h3 id="_2-2-服务拆分示例"><a href="#_2-2-服务拆分示例" class="header-anchor">#</a> 2.2 服务拆分示例</h3> <p>有一个 cloud-demo 工程，里面有两个微服务：</p> <ul><li>order-service：订单微服务，负责订单相关业务</li> <li>user-service：用户微服务，负责用户相关业务</li></ul> <p>要求：</p> <ul><li>订单微服务和用户微服务<strong>都必须有各自的数据库</strong>，相互独立</li> <li>订单服务和用户服务<strong>都对外暴露 Restful 的接口</strong></li> <li>订单服务如果需要查询用户信息，只能调用用户服务的 Restful 接口，不能查询用户数据库</li></ul> <p>项目结构：</p> <img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220305202451471.png" alt="image-20220305202451471" style="zoom:67%;"> <blockquote><p>用 IDEA 打开后，可以在 Services 一栏中看到所有的微服务：</p> <img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220305203644409.png" alt="image-20220305203644409" style="zoom:50%;"></blockquote> <h3 id="_2-3-远程调用案例"><a href="#_2-3-远程调用案例" class="header-anchor">#</a> 2.3 远程调用案例</h3> <p>在 order-service 服务中，有一个根据 id 查询订单的接口，在 user-service 中有一个根据 id 查询用户的接口。现在我们想修改 order-service 中的根据 id 查询订单业务，要求在查询订单的同时，根据订单中包含的 userId 查询出用户信息，一起返回：</p> <p><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210713213312278.png" alt="image-20210713213312278"></p> <p>因此，我们需要在 order-service 中，向 user-service 发起一个 http 的请求，调用<code>http://localhost:8081/user/{userId}</code>这个接口。大致步骤：</p> <ul><li>注册一个 RestTemplate 的实例到 Spring 容器</li> <li>修改 order-service 服务中的 OrderService 类中的 queryOrderById 方法，根据Order对象中的 userId 查询 User</li> <li>将查询的 User 填充到 Order 对象，一起返回</li></ul> <h4 id="_1-注册-resttemplate"><a href="#_1-注册-resttemplate" class="header-anchor">#</a> 1）注册 RestTemplate</h4> <p>注入一个 RestTemplate 的 Bean：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestTemplate</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_2-实现远程调用"><a href="#_2-实现远程调用" class="header-anchor">#</a> 2）实现远程调用</h4> <p>修改 order-service 服务中的 OrderService 类中的 queryOrderById 方法：</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">OrderMapper</span> orderMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Order</span> <span class="token function">queryOrderById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1.查询订单</span>
        <span class="token class-name">Order</span> order <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.利用RestTemplate发起http请求，查询用户</span>
        <span class="token comment">// 2.1.url路径</span>
        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8081/user/&quot;</span> <span class="token operator">+</span> order<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.2.发送http请求，实现远程调用</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.封装user到Order</span>
        order<span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4.返回</span>
        <span class="token keyword">return</span> order<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="_2-4-提供者与消费者"><a href="#_2-4-提供者与消费者" class="header-anchor">#</a> 2.4 提供者与消费者</h3> <p><strong>服务提供者</strong>：一次业务中，被其它微服务调用的服务。（提供接口给其它微服务）</p> <p><strong>服务消费者</strong>：一次业务中，调用其它微服务的服务。（调用其它微服务提供的接口）</p> <p>服务提供者与服务消费者的<strong>角色并不是绝对的</strong>，而是相对于业务而言。一个服务既可以是提供者，也可以是消费者。</p> <h2 id="_3-eureka-注册中心"><a href="#_3-eureka-注册中心" class="header-anchor">#</a> 3. Eureka 注册中心</h2> <h3 id="_3-1-eureka-的结构和作用"><a href="#_3-1-eureka-的结构和作用" class="header-anchor">#</a> 3.1 Eureka 的结构和作用</h3> <p><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210713220104956.png" alt="image-20210713220104956"></p> <p>🖊 <strong>问题 1</strong>：order-service 如何得知 user-service 实例地址？</p> <ul><li>user-service 服务实例启动后，将自己的信息注册到 eureka-server（Eureka服务端），这个叫<strong>服务注册</strong>。</li> <li>eureka-server 保存<strong>服务名称到服务实例地址</strong>列表的映射关系</li> <li>order-service 根据服务名称，拉取实例地址列表。这个叫<strong>服务发现</strong>或服务拉取。</li></ul> <p>🖊 <strong>问题 2</strong>：order-service 如何从多个 user-service 实例中选择具体的实例？</p> <ul><li>服务消费者利用负载均衡算法，从服务列表中挑选一个</li></ul> <p>🖊 <strong>问题 3</strong>：order-service 如何得知某个 user-service 实例是否依然健康，是不是已经宕机？</p> <ul><li>user-service 会每隔一段时间（默认30秒）向 eureka-server 发起请求，报告自己状态，称为<strong>心跳</strong></li> <li>当超过一定时间没有发送心跳时，eureka-server 会认为微服务实例故障，将该实例从服务列表中剔除</li> <li>order-service 拉取服务时，就能将故障实例排除了</li></ul> <h3 id="_3-2-搭建-eureka-server"><a href="#_3-2-搭建-eureka-server" class="header-anchor">#</a> 3.2 搭建 Eureka Server</h3> <p>首先大家注册中心服务端：eureka-server，这必须是一个独立的微服务。</p> <h4 id="_1-创建-eureka-server-服务"><a href="#_1-创建-eureka-server-服务" class="header-anchor">#</a> 1）创建 eureka-server 服务</h4> <p>在 cloud-demo 父工程下，创建一个子模块并填写相关信息：</p> <p><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210713220605881.png" alt="image-20210713220605881"></p> <p>该服务可以命名为 <code>eureka-server</code>。</p> <h4 id="_2-引入-eureka-依赖"><a href="#_2-引入-eureka-依赖" class="header-anchor">#</a> 2）引入 Eureka 依赖</h4> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_3-编写启动类"><a href="#_3-编写启动类" class="header-anchor">#</a> 3）编写启动类</h4> <p>给 eureka-server 服务编写一个启动类，一定要添加一个 <strong>@EnableEurekaServer</strong> 注解，开启 eureka 的注册中心功能：</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>eureka</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>eureka<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">EnableEurekaServer</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableEurekaServer</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EurekaApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">EurekaApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_4-编写配置文件"><a href="#_4-编写配置文件" class="header-anchor">#</a> 4）编写配置文件</h4> <p>编写一个 application.yml 文件，内容如下：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10086</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> eureka<span class="token punctuation">-</span>server
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span> 
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>10086/eureka
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>Eureka 由于自己本身也是一个微服务，所有自己也会将自己注册进去。</li></ul> <h4 id="_5-启动服务"><a href="#_5-启动服务" class="header-anchor">#</a> 5）启动服务</h4> <p>启动微服务，然后在浏览器访问：<code>http://127.0.0.1:10086</code></p> <p>看到下面结果应该是成功了：</p> <img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210713222157190.png" alt="image-20210713222157190" style="zoom:50%;"> <h3 id="_3-3-服务注册"><a href="#_3-3-服务注册" class="header-anchor">#</a> 3.3 服务注册</h3> <p>下面，我们将 user-service 注册到 eureka-server 中去。</p> <h4 id="_1-引入依赖"><a href="#_1-引入依赖" class="header-anchor">#</a> 1）引入依赖</h4> <p>在 user-service 的pom文件中，引入下面的 eureka-client 依赖：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>注意刚刚的是 Eureka server 端，现在的是 client 端。</li></ul> <h4 id="_2-配置文件"><a href="#_2-配置文件" class="header-anchor">#</a> 2）配置文件</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> userservice  <span class="token comment"># 该服务的名称</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>  <span class="token comment"># Eureka 的地址信息</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>10086/eureka
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>到此，该服务就被注册进 Eureka 中了。其他服务的配置也类似。</p> <h4 id="_3-启动多个-user-service-实例"><a href="#_3-启动多个-user-service-实例" class="header-anchor">#</a> 3）启动多个 user-service 实例</h4> <p>为了演示一个服务有多个实例的场景，我们添加一个 Spring Boot 的启动配置，再启动一个 user-service。</p> <p>首先，复制原来的 user-service 启动配置：</p> <img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210713222656562.png" alt="image-20210713222656562" style="zoom:67%;"> <p>然后，在弹出的窗口中，填写信息：</p> <img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210713222757702.png" alt="image-20210713222757702" style="zoom:40%;"> <p>现在，Spring Boot 窗口会出现两个 user-service 启动配置：</p> <img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210713222841951.png" alt="image-20210713222841951" style="zoom:67%;"> <p>不过，第一个是 8081 端口，第二个是 8082 端口。</p> <p>启动两个 user-service 实例：</p> <img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210713223041491.png" alt="image-20210713223041491" style="zoom:67%;"> <p>查看 eureka-server 管理页面：</p> <p><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210713223150650.png" alt="image-20210713223150650"></p> <h3 id="_3-4-服务发现"><a href="#_3-4-服务发现" class="header-anchor">#</a> 3.4 服务发现</h3> <p>最后，我们要去 eureka-server 中拉取 user-service 服务的实例列表，并且实现负载均衡。不过这些动作不用我们去做，<u>只需要添加一些注解即可</u>。</p> <p>在 order-service 的 OrderApplication 中，给 RestTemplate 这个 Bean 添加一个 <strong>@LoadBalanced</strong> 注解：</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-java"><code><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">&quot;cn.itcast.order.mapper&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">OrderApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 创建RestTemplate并注入Spring容器
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@LoadBalanced</span>
    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>修改 order-service 服务中的 cn.itcast.order.service 包下的 OrderService 类中的 queryOrderById 方法。修改访问的 url 路径，<strong>用服务名代替 ip 和端口</strong>：</p> <div class="language-diff line-numbers-mode"><pre class="language-diff"><code>@Service
public class OrderService {

<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   @Autowired
</span><span class="token prefix unchanged"> </span><span class="token line">   private OrderMapper orderMapper;
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   @Autowired
</span><span class="token prefix unchanged"> </span><span class="token line">   private RestTemplate restTemplate;
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   public Order queryOrderById(Long orderId) {
</span><span class="token prefix unchanged"> </span><span class="token line">       // 1.查询订单
</span><span class="token prefix unchanged"> </span><span class="token line">       Order order = orderMapper.findById(orderId);
</span><span class="token prefix unchanged"> </span><span class="token line">       // 2.利用RestTemplate发起http请求，查询用户
</span><span class="token prefix unchanged"> </span><span class="token line">       // 2.1.url 路径
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">        String url = &quot;http://localhost:8081/user/&quot; + order.getUserId();
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">        String url = &quot;http://userservice/user/&quot; + order.getUserId();
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       // 2.2.发送http请求，实现远程调用
</span><span class="token prefix unchanged"> </span><span class="token line">       User user = restTemplate.getForObject(url, User.class);
</span><span class="token prefix unchanged"> </span><span class="token line">       // 3.封装user到Order
</span><span class="token prefix unchanged"> </span><span class="token line">       order.setUser(user);
</span><span class="token prefix unchanged"> </span><span class="token line">       // 4.返回
</span><span class="token prefix unchanged"> </span><span class="token line">       return order;
</span><span class="token prefix unchanged"> </span><span class="token line">   }
</span></span>}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><ul><li>注意请求的 URL 的变化，<strong>用服务名代替 ip 和端口</strong>，这个服务名就是注册入 Eureka 中的。</li></ul> <p><strong>Spring 会自动帮助我们从 eureka-server 端，根据 userservice 这个服务名称，获取实例列表，而后完成负载均衡</strong>。</p> <h2 id="_4-ribbon-负载均衡"><a href="#_4-ribbon-负载均衡" class="header-anchor">#</a> 4. Ribbon 负载均衡</h2> <p>Spring Cloud 底层其实是利用了一个名为 Ribbon 的组件，来实现负载均衡功能的。负载均衡的流程：</p> <p><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210713224517686.png" alt="image-20210713224517686"></p> <h3 id="_4-1-原理分析"><a href="#_4-1-原理分析" class="header-anchor">#</a> 4.1 原理分析</h3> <p>分析源码后，可以看到 Ribbon 的底层采用了一个<strong>拦截器</strong>，拦截了 RestTemplate 发出的请求，对地址做了修改。用一幅图来总结一下：</p> <p><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210713224724673.png" alt="image-20210713224724673"></p> <p>基本流程如下：</p> <ul><li>拦截我们的 RestTemplate 请求 <code>http://userservice/user/1</code></li> <li>RibbonLoadBalancerClient 会从请求 url 中获取服务名称，也就是 user-service</li> <li>DynamicServerListLoadBalancer 根据 user-service 到 eureka 拉取服务列表</li> <li>eureka 返回列表，localhost:8081、localhost:8082</li> <li>IRule 利用内置负载均衡规则，从列表中选择一个，例如 localhost:8081</li> <li>RibbonLoadBalancerClient 修改请求地址，用 localhost:8081 替代 userservice，得到 <code>http://localhost:8081/user/1</code>，发起真实请求</li></ul> <h3 id="_4-2-负载均衡策略"><a href="#_4-2-负载均衡策略" class="header-anchor">#</a> 4.2 负载均衡策略</h3> <h4 id="_4-2-1-自带的负载均衡策略"><a href="#_4-2-1-自带的负载均衡策略" class="header-anchor">#</a> 4.2.1 自带的负载均衡策略</h4> <p>负载均衡的规则都定义在 <strong>IRule 接口</strong>中，而 IRule 有很多不同的实现类，代表了不同的规则。不同规则的含义如下：</p> <table><thead><tr><th style="text-align:center;"><strong>内置负载均衡规则类</strong></th> <th><strong>规则描述</strong></th></tr></thead> <tbody><tr><td style="text-align:center;">RoundRobinRule</td> <td><strong>简单轮询</strong>服务列表来选择服务器。它是 Ribbon <strong>默认的</strong>负载均衡规则。</td></tr> <tr><td style="text-align:center;">AvailabilityFilteringRule</td> <td>对以下两种服务器进行忽略：   （1）在默认情况下，这台服务器如果3次连接失败，这台服务器就会被设置为“短路”状态。短路状态将持续30秒，如果再次连接失败，短路的持续时间就会几何级地增加。  （2）并发数过高的服务器。如果一个服务器的并发连接数过高，配置了AvailabilityFilteringRule规则的客户端也会将其忽略。并发连接数的上限，可以由客户端的 <code>&lt;clientName&gt;.&lt;clientConfigNameSpace&gt;.ActiveConnectionsLimit</code> 属性进行配置。</td></tr> <tr><td style="text-align:center;">WeightedResponseTimeRule</td> <td>为每一个服务器赋予一个<strong>权重值</strong>。服务器响应时间越长，这个服务器的权重就越小。这个规则会随机选择服务器，这个权重值会影响服务器的选择。</td></tr> <tr><td style="text-align:center;">ZoneAvoidanceRule</td> <td>以区域可用的服务器为基础进行服务器的选择。使用Zone对服务器进行分类，这个Zone可以理解为一个机房、一个机架等。而后再<strong>对 Zone 内的多个服务做轮询</strong>。</td></tr> <tr><td style="text-align:center;">BestAvailableRule</td> <td>忽略那些短路的服务器，并选择并发数较低的服务器。</td></tr> <tr><td style="text-align:center;">RandomRule</td> <td><strong>随机</strong>选择一个可用的服务器。</td></tr> <tr><td style="text-align:center;">RetryRule</td> <td><strong>重试</strong>机制的选择逻辑</td></tr></tbody></table> <ul><li>正常情况下，<strong>采用默认的策略即可</strong>。</li></ul> <h4 id="_4-2-2-自定义负载均衡策略"><a href="#_4-2-2-自定义负载均衡策略" class="header-anchor">#</a> 4.2.2 自定义负载均衡策略</h4> <p>通过定义 IRule 实现可以修改负载均衡规则，有两种方式：</p> <p>🖊 <strong>方式1 —— 代码方式</strong>：在 order-service 中的 OrderApplication 类中，定义一个新的 IRule：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">IRule</span> <span class="token function">randomRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RandomRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>🖊 <strong>方式2 —— 配置文件方式</strong>：在 order-service 的 application.yml 文件中，添加新的配置也可以修改规则：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">userservice</span><span class="token punctuation">:</span> <span class="token comment"># 给某个微服务配置负载均衡规则</span>
  <span class="token key atrule">ribbon</span><span class="token punctuation">:</span>
    <span class="token key atrule">NFLoadBalancerRuleClassName</span><span class="token punctuation">:</span> com.netflix.loadbalancer.RandomRule <span class="token comment"># 负载均衡规则 </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_4-3-饥饿加载"><a href="#_4-3-饥饿加载" class="header-anchor">#</a> 4.3 饥饿加载</h3> <p>Ribbon 默认是采用<strong>懒加载</strong>，即第一次访问时才会去创建 LoadBalanceClient，请求时间会很长。</p> <blockquote><p>这可以在浏览器开发者工具的“网络”中看到请求时间。</p></blockquote> <p>而<strong>饥饿加载</strong>则会在项目启动时创建，降低第一次访问的耗时，通过下面配置开启饥饿加载：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">ribbon</span><span class="token punctuation">:</span>
  <span class="token key atrule">eager-load</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment"># 开启饥饿加载</span>
    <span class="token key atrule">clients</span><span class="token punctuation">:</span> userservice  <span class="token comment"># 指定对哪个服务做饥饿加载</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>饥饿加载，顾名思义就是饥不择食，在创建之初就加载起来了。</p></blockquote> <h2 id="_5-nacos-注册中心"><a href="#_5-nacos-注册中心" class="header-anchor">#</a> 5. Nacos 注册中心</h2> <p>Nacos 是 Spring Cloud Alibaba 的组件，而 Spring Cloud Alibaba 也遵循 Spring Cloud 中定义的服务注册、服务发现规范。因此使用 Nacos 和使用 Eureka 对于微服务来说，并没有太大区别。</p> <blockquote><p>先安装单机版 Nacos</p></blockquote> <h3 id="_5-1-服务注册到-nacos"><a href="#_5-1-服务注册到-nacos" class="header-anchor">#</a> 5.1 服务注册到 nacos</h3> <p>与 Eureka 主要差异在于：依赖不同，服务地址不同。</p> <h4 id="_1-引入依赖-2"><a href="#_1-引入依赖-2" class="header-anchor">#</a> 1）引入依赖</h4> <p>在cloud-demo父工程的 pom 文件中的 <code>&lt;dependencyManagement&gt;</code> 中引入 Spring Cloud Alibaba 的依赖：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.6.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>然后在 user-service 和 order-service 中的 pom 文件中引入 nacos-discovery 依赖：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>注意不要忘了注释掉 eureka 的依赖。</li></ul> <h4 id="_2-配置-nacos-地址"><a href="#_2-配置-nacos-地址" class="header-anchor">#</a> 2）配置 nacos 地址</h4> <p>在 user-service 和 order-service 的 application.yml 中添加 nacos 地址：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>不要忘了注释掉eureka的地址</li></ul> <h4 id="_3-启动微服务"><a href="#_3-启动微服务" class="header-anchor">#</a> 3）启动微服务</h4> <p>启动微服务后，登录 nacos 管理页面，可以看到微服务信息：</p> <p><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210713231439607.png" alt="image-20210713231439607"></p> <h3 id="_5-2-服务分级存储模型"><a href="#_5-2-服务分级存储模型" class="header-anchor">#</a> 5.2 服务分级存储模型</h3> <p>一个<strong>服务</strong>可以有多个<strong>实例</strong>，Nacos 就将同一机房内的实例划分为一个<strong>集群</strong>。也就是说，user-service 是服务，一个服务可以包含多个集群，如杭州、上海，每个集群下可以有多个实例，形成分级模型，如图：</p> <p><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210713232522531.png" alt="image-20210713232522531"></p> <p>微服务互相访问时，<strong>应该尽可能访问同集群实例</strong>，因为本地访问速度更快。当本集群内不可用时，才访问其它集群。</p> <h4 id="_5-2-1-给-user-service-配置集群"><a href="#_5-2-1-给-user-service-配置集群" class="header-anchor">#</a> 5.2.1 给 user-service 配置集群</h4> <p>修改 user-service 的 application.yml 文件，添加集群配置：</p> <div class="language-yaml line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br></div><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">cluster-name</span><span class="token punctuation">:</span> HZ <span class="token comment"># 集群名称</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>不同的实例，只需要修改 cluster-name 属性即可。</p> <p>启动多个实例后，在 nacos 控制台可以看到：</p> <p><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210713233727923.png" alt="image-20210713233727923"></p> <h4 id="_5-2-2-同集群优先的负载均衡"><a href="#_5-2-2-同集群优先的负载均衡" class="header-anchor">#</a> 5.2.2 同集群优先的负载均衡</h4> <p>默认的 <code>ZoneAvoidanceRule</code> 并不能实现根据同集群优先来实现负载均衡。因此 Nacos 中提供了一个 <code>NacosRule</code> 的实现，可以优先从同集群中挑选实例。</p> <h5 id="_1-给-order-service-配置集群信息"><a href="#_1-给-order-service-配置集群信息" class="header-anchor">#</a> 1）给 order-service 配置集群信息</h5> <p>修改 order-service 的 application.yml 文件，添加集群配置：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">cluster-name</span><span class="token punctuation">:</span> HZ <span class="token comment"># 集群名称</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="_2-修改负载均衡规则"><a href="#_2-修改负载均衡规则" class="header-anchor">#</a> 2）修改负载均衡规则</h5> <p>修改 order-service 的 application.yml 文件，修改负载均衡规则：</p> <div class="language-yaml line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br></div><pre class="language-yaml"><code><span class="token key atrule">userservice</span><span class="token punctuation">:</span>
  <span class="token key atrule">ribbon</span><span class="token punctuation">:</span>
    <span class="token key atrule">NFLoadBalancerRuleClassName</span><span class="token punctuation">:</span> com.alibaba.cloud.nacos.ribbon.NacosRule <span class="token comment"># 负载均衡规则 </span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>NacosRule</code> 负载均衡策略：</p> <ol><li>优先选择同集群服务实例列表</li> <li>本地集群找不到提供者，才去其它集群寻找，并且会报警告</li> <li>确定了可用实例列表后，再采用随机负载均衡挑选实例</li></ol> <h3 id="_5-3-权重配置"><a href="#_5-3-权重配置" class="header-anchor">#</a> 5.3 权重配置</h3> <p>实际部署中会出现这样的场景：服务器设备性能有差异，部分实例所在机器性能较好，另一些较差，<strong>我们希望性能好的机器承担更多的用户请求</strong>。但默认情况下 NacosRule 是同集群内随机挑选，不会考虑机器的性能问题。因此，Nacos 提供了<strong>权重配置来控制访问频率</strong>，权重越大则访问频率越高。</p> <p>在 nacos 控制台，找到 user-service 的实例列表，点击编辑，即可修改权重：</p> <p><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210713235133225.png" alt="image-20210713235133225"></p> <p>在弹出的编辑窗口，修改权重：</p> <img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210713235235219.png" alt="image-20210713235235219" style="zoom:33%;"> <ul><li>如果权重修改为 0，则该实例永远不会被访问。</li></ul> <h3 id="_5-4-环境隔离"><a href="#_5-4-环境隔离" class="header-anchor">#</a> 5.4 环境隔离</h3> <p>Nacos 中服务存储和数据存储的最外层都是一个名为 <strong>namespace</strong> 的东西，用来做最外层的环境隔离。</p> <ul><li>nacos 中可以有多个 namespace</li> <li>namespace 下可以有 group、service 等</li> <li>不同 namespace 之间相互隔离，例如不同 namespace 的服务互相不可见</li></ul> <img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210714000101516.png" alt="image-20210714000101516" style="zoom:33%;"> <h4 id="_5-4-1-创建-namespace"><a href="#_5-4-1-创建-namespace" class="header-anchor">#</a> 5.4.1 创建 namespace</h4> <p>默认情况下，所有 service、data、group 都在同一个 namespace，名为 public：</p> <img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210714000414781.png" alt="image-20210714000414781" style="zoom:50%;"> <p>在该页面可以点击新增按钮，从而添加一个 namespace：</p> <p><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20220306142315482.png" alt="image-20220306142315482"></p> <ul><li>dev 是新增加的 namespace</li></ul> <h4 id="_5-4-2-给微服务配置-namespace"><a href="#_5-4-2-给微服务配置-namespace" class="header-anchor">#</a> 5.4.2 给微服务配置 namespace</h4> <p>给微服务配置 namespace 只能通过修改配置来实现。</p> <p>例如，修改 order-service 的 application.yml 文件：</p> <div class="language-yaml line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br></div><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">cluster-name</span><span class="token punctuation">:</span> HZ
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> 492a7d5d<span class="token punctuation">-</span>237b<span class="token punctuation">-</span>46a1<span class="token punctuation">-</span>a99a<span class="token punctuation">-</span>fa8e98e4b0f9 <span class="token comment"># 命名空间，填ID</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>重启 order-service 后，访问控制台，可以在 dev 的 namespace 下看到该服务实例。此时访问 order-service，因为 namespace 不同，会导致找不到处于其他命名空间的 user-service，控制台会报错：</p> <img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210714000941256.png" alt="image-20210714000941256" style="zoom:67%;"> <h3 id="_5-5-nacos-与-eureka-的区别"><a href="#_5-5-nacos-与-eureka-的区别" class="header-anchor">#</a> 5.5 Nacos 与 Eureka 的区别</h3> <p>Nacos 的服务实例分为两种类型：</p> <ul><li><p>临时实例：如果实例宕机超过一定时间，会从服务列表剔除，默认的类型。</p></li> <li><p>非临时实例：如果实例宕机，不会从服务列表剔除，也可以叫永久实例。</p></li></ul> <p>配置一个服务实例为永久实例：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">ephemeral</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 设置为非临时实例</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Nacos 和 Eureka 整体结构类似，服务注册、服务拉取、心跳等待，但是也存在一些差异：</p> <img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/image-20210714001728017.png" alt="image-20210714001728017" style="zoom:80%;"> <ul><li><p>Nacos 与 Eureka 的共同点</p> <ul><li>都支持服务注册和服务拉取</li> <li>都支持服务提供者心跳方式做健康检测</li></ul></li> <li><p>Nacos 与 Eureka 的区别</p> <ul><li>Nacos 支持服务端主动检测提供者状态：临时实例采用心跳模式，非临时实例采用主动检测模式</li> <li>临时实例心跳不正常会被剔除，非临时实例则不会被剔除，只是显示为不健康了</li> <li>Nacos 支持服务列表变更的消息推送模式，服务列表更新更及时</li> <li>Nacos 集群默认采用 AP 方式，当集群中存在非临时实例时，采用 CP 模式；Eureka 采用 AP 方式</li></ul></li></ul></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/09/18, 21:30:41</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/notebook/pages/833cd8/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">SpringCloud微服务初识</div></a> <a href="/notebook/pages/fe23e5/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Spring Cloud 快速入门 2：配置管理、远程调用和网关</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/notebook/pages/833cd8/" class="prev">SpringCloud微服务初识</a></span> <span class="next"><a href="/notebook/pages/fe23e5/">Spring Cloud 快速入门 2：配置管理、远程调用和网关</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/notebook/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/notebook/pages/cb9907/"><div>
            RabbitMQ总结
            <!----></div></a> <span class="date">04-25</span></dt></dl><dl><dd>02</dd> <dt><a href="/notebook/pages/baaf76/"><div>
            LinkedHashMap源码分析
            <!----></div></a> <span class="date">04-25</span></dt></dl><dl><dd>03</dd> <dt><a href="/notebook/pages/eacb25/"><div>
            ConcurrentHashMap源码分析
            <!----></div></a> <span class="date">04-25</span></dt></dl> <dl><dd></dd> <dt><a href="/notebook/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="1484311465@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/progressforeverever" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2024
    <span></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><span class="close-but">×</span> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/notebook/assets/js/app.8978aa11.js" defer></script><script src="/notebook/assets/js/2.3295585a.js" defer></script><script src="/notebook/assets/js/94.1cfba720.js" defer></script>
  </body>
</html>
