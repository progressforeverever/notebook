---
title: 王道操作系统第一章
date: 2023-10-24 21:05:33
permalink: /pages/a8733d/
categories:
  - 计算机基础
  - 操作系统
tags:
  - 
---
# 操作系统的定义

![image-20231024195256432](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024195256432.png)



计算机的层次结构

1. 先有基本的硬件
2. 在硬件上安装操作系统
3. 注意这里的图片，操作系统是和用户和应用程序（软件）都有接触的，也就是用户也能直接调用操作系统提供的一些服务



操作系统（OperatingSystem，OS）是指控制和**管理整个计算机系统的硬件和软件资源**，并合理地**组织调度**计算机的工作和**资源的分配**；以提供给用户和其他软件**方便的接口和环境**；它是计算机系统中**最基本的系统软件。**

总结：

- 系统资源的管理者
- 向上提供服务  （封装思想）
- 最接近硬件的软件

![image-20231024195655026](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024200016545.png)



补充知识：**执行一个程序前需要将该程序放到内存中，才能被CPU处理。** 

用QQ和朋友视频聊天的过程：

-  Step1：在各个文件夹中找到QQ安装的位置（如D:/Tencent/QQ/Bin） （ 逐层打开文件夹 ，找到QQ.exe 这个程序（可执行文件）的存放位置需要把该程序相关数据放入内存 **文件管理**）
- Step2：双击打开QQ.exe （对应的进程被处理机（CPU）处理）
- Step3：QQ程序正常运行 
- Step4：开始和朋友视频聊天，（需要**将摄像头设备分配给进程**）



向上层提供服务

- GUI：图形化用户接口（Graphical User Interface）
- 联机命令接口实例（Windows系统）联机命令接口=交互式命令接口![image-20231024200016545](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024195655026.png)
- 脱机命令接口实例（Windows系统）脱机命令接口=批处理命令接口![image-20231024200042160](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024200114258.png)
- 程序接口![image-20231024200114258](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024200042160.png)





总结：

![image-20231024200204961](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024200151370.png)

![image-20231024200708721](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024200204961.png)





## 操作系统的四个特征

- 并发
- 共享
- 虚拟
- 异步



（并发与共享是两个最基本的特征，二者互为存在条件）



### 并发与并行

**并发**：指两个或多个事件在同一时间间隔内发生。这些事件**宏观上是同时发生的，但微观上是交替发生的。** 

**并行**：**指两个或多个事件在同一时刻同时发生。**

![image-20231024200151370](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024200708721.png)





注意（重要考点）：

-  **单核CPU**同一时刻只能执行一个程序，各个程序只能**并发**地执行
-  多核CPU同一时刻可以同时执行多个程序，多个程序可以**并行**地执行 

比如Intel的第八代i3处理器就是4核CPU，意味着可以并行地执行4个程序





### 共享

共享即资源共享，是指系统中的资源可供内存中多个并发执行的进程共同使用

- 互斥式共享   （一个时间段内只允 许一个进程访问该资源）
- 同时共享    （系统中的某些资源，允许一个时间段 内由多个进程“同时”对它们进行访问  **微观上看，两个进程是交替着访问硬盘的。**）



**所谓的“同时”往往是宏观上的，而在微观上，这些进程可能是交替地对该资源进行访问的（即分时共享）** 

生活实例： 互斥共享方式：使用QQ和微信视频。同一时间段内摄像头只能分配给其中一个进程。 同时共享方式：使用QQ发送文件A，同时使用微信发送文件B。宏观上看，两边都在同时读取并发送文件， 说明两个进程都在访问硬盘资源，从中读取数据。微观上看，两个进程是交替着访问硬盘的。

![image-20231024201041176](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024201041176.png)



### 虚拟

虚拟是指把一个物理上的实体变为若干个逻辑上的对应物。物理实体（前者）是实际存在的，而逻辑上 对应物（后者）是用户感受到的





![image-20231024201125096](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024201125096.png)





### 异步

**异步是指，在多道程序环境下，允许多个程序并发执行**，但由于**资源有限，进程的执行不是一贯到底的**， 而是走走停停，以不可预知的速度向前推进，这就是进程的异步性。



![image-20231024201227650](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024201227650.png)



## 操作系统的发展与分类





### 单道批处理系统

![image-20231024201320706](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024201355194.png)

主要优点：缓解了一定 程度的人机速度矛盾， 资源利用率有所提升。 

主要缺点：内存中仅能 有一道程序运行，只有 该程序运行结束之后才能调入下一道程序。 CPU有大量的时间是在 空闲等待I/O完成。资源 利用率依然很低





### 多道批处理系统

![image-20231024201355194](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024201444674.png)



**操作系统的正式诞生**



主要优点：多道程序并发执行，共享计算机 资源。资源利用率大幅提升，CPU和其他资 源更能保持“忙碌”状态，系统吞吐量增大。 

主要缺点：用户响应时间长，没有人机交互功能（用户提交自己的作业之后就只能等待 计算机处理完成，中间不能控制自己的作业 执行。**eg：无法调试程序/无法在程序运行过 程中输入一些参数）**



### 分时操作系统

![image-20231024202825835](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024201528048.png)

分时操作系统：计算机以时间片为单位轮流为各个用户/作业服务，各个用户可通过终端与计算机进行交互。 

主要优点：用户请求可以被即时响应，解决了人机交互问题。允许多个用户同时使用一台计算机，并且用 户对计算机的操作相互独立，感受不到别人的存在。 

主要缺点：不能优先处理一些紧急任务。操作系统对各个用户/作业都是完全公平的，**循环地为每个用户/ 作业服务一个时间片，不区分任务的紧急性**



![image-20231024202511090](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024201320706.png)



## 操作系统的运行机制



一条高级语言的代 码翻译过来可能会 对应多条机器指令

程序运行的过程其实就 是CPU执行一条一条的 机器指令的过程，“指令”就是处理器（CPU）能识别、执行的最基本命令



我们普通程序员写的程序就是“应用程序” 

微软、苹果有一帮人负责实现操作系统，他们写的是“内核程序” 

**由很多内核程序组成了“操作系统内核”，或简称“内核（Kernel）”** 

内核是操作系统最重要最核心的部分，也是最接近硬件的部分 

甚至可以说，一个操作系统只要有内核就够了（eg：Docker—>仅需Linux内核） 操作系统的功能未必都在内核中，如图形化用户界面GUI





### 特权指令 &&非特权指令

应用程序只能使用**非特权指令**，如： 加法指令、减法指令等

操作系统内核作为“管理者”，有时会让CPU执行一些 **“特权指令”**，如：**内存清零指令。这些指令影响重大， 只允许“管理者”——即操作系统内核来使用**

**在CPU设计和生产的时 候就划分了特权指令和 非特权指令，因此CPU 执行一条指令前就能判 断出其类型**



### 内核态&&用户态



CPU有两种状态，“内核态”和“用户态” 

- 处于内核态时，说明此时正在运行的是内核程序，此时可以执行特权指令 
- 处于用户态时，说明此时正在运行的是应用程序，此时只能执行非特权指令



> CPU能判断出指令类型，但是它怎么区分此时正在运行 的是内核程序or应用程序？

拓展：CPU中有一个寄存器叫**程序状态字寄存器（PSW）**，其中有个二进制位，**1表示 “内核态”，0表示“用户态”**



> 如何实 现CPU状态的 切换？

- 内核态 —> 用户态：执行一条特权指令——**修改PSW的标志位为“用户态”，这个动作意味着操作系统 将主动让出CPU使用权**
- 用户态—> 内核态：由**中断引发**，硬件自动完成变态过程，**触发中断信号意味着操作系统将强行夺 回CPU的使用权**

![image-20231024201528048](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024202511090.png)



**原语**是一种特殊的**程序**。 是最接近硬件的部分，这 种程**序的运行具有原子性。**



## 中断和异常

“中断”是让操作系统内核夺回CPU使用权的唯一途径

![image-20231024201444674](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024202825835.png)

![image-20231024203947228](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024203334821.png)

### 内中断

- 内中断：与当前执行的指令有关， 中断信号来源于CPU内部，试图在用户态下执行特权指令

  ![image-20231024202935838](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024202935838.png)

  

若当前执行的指令是非法的（指令非法，以及指令的一些参数是非法的，会引起中断信号），则 会引发一个中断信号

例子3：有时候**应用程序想请求操作系统内核的服务**，此时会执行一条特殊的指令——**陷入指令**，该指 令会**引发一个内部中断信号**

执行“陷入指令”，意味着**应用程序主动地将CPU控制权还给操作系统内核。 “系统调用”就是通过陷入指令完成的**

**陷入指令并不是特权指令，因为运行在用户态**



- 在用户态尝试调用特权指令
- 指令或指令参数非法
- 通过陷入指令请求调用操作系统内核服务





### 外中断



![image-20231024203257409](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024203257409.png)



- 时钟信号终端
- IO中断



总结：

![image-20231024203334821](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024204318408.png)





### 中断处理

不同的中断信号，需要用不同的中断处理程序来处理。当CPU检测到中断信号后，会根据中断信号 的类型去查询“中断向量表”，以此来找到相应的**中断处理程序**在内存中的存放位置。

**显然，中断处理 程序一定是内核 程序，需要运行 在“内核态**





## 系统调用

![image-20231024203903005](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024203903005.png)



有的库函数涉及系统调用，有的不涉及



应用程序通过系统调用请求操作系统的服务。而系统中的各种共享资源都由操作系统内核统一掌管，

因此凡是与共享资源有关的操作（如存储分配、I/O操作、文件管理等），都必须通过系统调用的方式向操作系统内核提 出服务请求，由操作系统内核代为完成。这样可以保证系统的稳定性和安全性，防止用户进行非法操作。



因此这里都是后面要学习的内容



### 系统调用过程

1. 传递系统调用类型参数，指明调用哪种服务（此时是在用户态）

2. 执行陷入指令（用户态），请求调用

3. 执行相应的内请求核程序处理系统调用（核心态）

4. 返回 应用程序 

   注意：

   1.陷入指令是在用户态执行的，执行陷入指令之后立即引发一个内中断，使CPU进入核心态 

   2.发出系统调用请求是在用户态，而对系统调用的相应处理在核心态下进行



## 操作系统的体系结构



![image-20231024204318408](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024203947228.png)





### 大内核与微内核

![image-20231024204659796](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024204832330.png)



注意： 

操作系统内核需要运行在内核态 

操作系统的非内核功能运行在用户态

再加上之前所学的，系统的调用涉及到状态的切换，状态的切换需要开销





大内核：顾名思义，把所有的都放在内核态中

微内核：只保留基本的功能



![image-20231024204922315](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024210310092.png)

![image-20231024205355641](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024204659796.png)



![image-20231024205411513](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024204922315.png)







## 操作系统引导（Boot）

操作系统引导（boot）——**开机的时候， 怎么让操作系统运行起来**

一开始磁盘为空，啥也没有

安装操作系统后，磁盘进行了分盘，同时加上了主引导记录（MBR，包含了磁盘引导程序和分区表）

![image-20231024204832330](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024205355641.png)

![image-20231024210310092](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024205411513.png)

然后内存分为RAM和ROM，RAM断电丢失，ROM断电不丢失，ROM中存放BIOS，

BIOS(Basic Input/Output System) 基本输入输出系统，包含了ROM引导程序，包括自举程序



操作系统引导：

 ①CPU从一个特定主存地址开始，取指令，**执行ROM中的引导程序**（先进行硬件自检，再开机）

 ②将磁盘的第一块——主引导记录读入内存，执行磁盘引导程序，扫描分区表 

③从活动分区（**又称主分区，即安装了操作系统的分区）读入分区引导记录，执行其中的程序**

 ④从根目录下找到完整的操作系统初始化程序（即启动管理器）并执行，完成“开机”的一系列动作





## 虚拟机

虚拟机：使用虚拟化技术，将一台物理机器虚拟化为多台虚拟机器（VirtualMachine,VM），每个虚拟机器都 可以独立运行一个操作系统

![image-20231024210331008](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024210331008.png)



第一类：直接运行在硬件上：

那么如何进行硬件的划分呢？
CPU：时间片划分
内存磁盘：就直接划分



![image-20231024210417760](https://czynotebook.oss-cn-beijing.aliyuncs.com/notebook/image-20231024210417760.png)